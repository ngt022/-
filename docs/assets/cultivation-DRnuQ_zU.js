const t=t=>Math.max(1,Math.floor(1*t*2)),e=(e,s)=>{let a=t(e);return Math.random()<.3*s&&(a*=2),a};self.onmessage=({data:s})=>{const{type:a,playerData:o}=s;if("cultivateUntilBreakthrough"===a)try{const{level:s,spirit:a,cultivation:r,maxCultivation:i,luck:l}=o,n=(t=>Math.max(10,Math.floor(10*Math.pow(t,1.5))))(s),c=t(s);if(c<=0)return void self.postMessage({type:"error",message:"修炼效率异常"});const p=Math.max(0,i-r),u=Math.ceil(p/c),M=u*n;if(a<M)return void self.postMessage({type:"error",message:`焰灵不足！突破需要${M}焰灵，当前焰灵：${a.toFixed(1)}`});let f=0,h=0;for(let t=0;t<u;t++){const t=e(s,l);t>c&&h++,f+=t}self.postMessage({type:"success",result:{spiritCost:M,cultivationGain:f,doubleGainTimes:h}})}catch(r){self.postMessage({type:"error",message:"修炼计算出错"})}};
