import{o as a,aC as s,bg as e,bF as l,bE as t,F as n,bn as o,bj as i,bh as r,W as u,r as c,bf as d,k as v,bk as p,bi as m,b7 as y,J as g,aW as f,b1 as b,q as h}from"./vendor-CBGg7cPT.js";import{_ as k,u as _}from"./index-C_Usn6qf.js";import{s as w}from"./sfx-Bhf_myqE.js";import{G as x}from"./GameGuide-Dc_uhL03.js";import{u as S,j as C,v as j,z,t as H,B as $}from"./naive-ui-CtewNtT3.js";const T={class:"boss-page"},N={class:"boss-header"},B={class:"boss-title"},I=["src"],F={key:1,class:"boss-icon"},W={class:"boss-name"},L={class:"boss-desc"},M={class:"hp-bar-wrap"},O={class:"hp-bar-bg"},D={class:"hp-text"},G={class:"boss-info-row"},J={class:"boss-body"},P={class:"boss-left"},Y={class:"attack-area"},A={key:0,class:"my-stats"},R={class:"gold"},q={class:"gold"},E={key:0,class:"medal gold"},K={key:1,class:"medal silver"},Q={key:2,class:"medal bronze"},U={key:3},V={class:"dmg-col"},X={class:"boss-right"},Z={class:"log-name"},aa={key:0,class:"log-crit"},sa={key:0,class:"log-empty"},ea={class:"gold"},la=k({__name:"WorldBoss",setup(k){const la=_(),ta=S(),na=c(null),oa=c(0),ia=c(0),ra=c(0),ua=c(0),ca=c([]),da=c([]),va=c([]),pa=c([]),ma=c([]),ya=c(!1),ga=c(!1),fa=c(!1),ba=c(0),ha=c(null),ka=c(null);let _a=null,wa=null,xa=null,Sa=0;const Ca=localStorage.getItem("xx_wallet")||"",ja=localStorage.getItem("xx_token")||"",za={Authorization:`Bearer ${ja}`},Ha={"ç„°èš€è››æ¯":"/assets/images/boss/boss_yanShi.png","é­”ç„°é¾™":"/assets/images/boss/boss_moYanLong.png","ç„°é­”æ ‘":"/assets/images/boss/boss_yanMoShu.png","é»‘ç„°å·¨äºº":"/assets/images/boss/boss_heiYanJuRen.png","ç„°çŸ³å…½":"/assets/images/boss/boss_yanShiShou.png","é­”ç„°å‡¤å‡°":"/assets/images/boss/boss_moYanFengHuang.png","è¿œå¤å¦–é¾™":"/assets/images/boss/boss_yuanGuYaoLong.png"},$a=a=>{if(!a)return null;for(const s of Object.keys(Ha))if(a.includes(s))return Ha[s];return null},Ta=h(()=>na.value&&0!==na.value.maxHp?na.value.currentHp/na.value.maxHp*100:0),Na=h(()=>ba.value<=0&&!ga.value),Ba=h(()=>da.value.some(a=>!a.claimed));function Ia(a){return a>=1e6?(a/1e6).toFixed(1)+"M":a>=1e4?(a/1e4).toFixed(1)+"W":(null==a?void 0:a.toLocaleString())||"0"}function Fa(a){if(!a)return"-";const s=new Date(a);return`${s.getMonth()+1}/${s.getDate()} ${String(s.getHours()).padStart(2,"0")}:${String(s.getMinutes()).padStart(2,"0")}`}async function Wa(){try{const a=await fetch("/api/boss/current",{headers:za}),s=await a.json();na.value=s.boss,oa.value=s.myDamage||0,ia.value=s.myAttacks||0,ra.value=s.myRank||0,ua.value=s.totalPlayers||0}catch{}}async function La(){try{const a=await fetch("/api/boss/ranking",{headers:za}),s=await a.json();ca.value=s.ranking||[]}catch{}}async function Ma(){try{const a=await fetch("/api/boss/rewards",{headers:za}),s=await a.json();da.value=s.rewards||[]}catch{}}async function Oa(){try{const a=await fetch("/api/boss/history",{headers:za}),s=await a.json();va.value=s.bosses||[]}catch{}}async function Da(){if(la.stopAutoCultivation(),Na.value&&!ga.value){ga.value=!0;try{const a=await fetch("/api/boss/attack",{method:"POST",headers:{...za,"Content-Type":"application/json"}}),s=await a.json();if(!a.ok)return void ta.error(s.error);if(na.value&&(na.value.currentHp=s.bossHp),oa.value=s.myTotalDamage,void 0!==la.spirit&&(la.spirit=s.spirit),function(a,s){const e=++Sa,l=40+120*Math.random();ma.value.push({id:e,damage:a,isCrit:s,x:l}),setTimeout(()=>{ma.value=ma.value.filter(a=>a.id!==e)},1500)}(s.damage,s.isCrit),s.isCrit)try{w.crit()}catch{}else try{w.hit()}catch{}ba.value=3,xa&&clearInterval(xa),xa=setInterval(()=>{ba.value--,ba.value<=0&&clearInterval(xa)},1e3),La()}catch(a){ta.error("æ”»å‡»å¤±è´¥")}finally{ga.value=!1}}}async function Ga(){fa.value=!0;try{const a=await fetch("/api/boss/rewards/claim",{method:"POST",headers:{...za,"Content-Type":"application/json"}}),s=await a.json();if(!a.ok)return void ta.error(s.error);ta.success(`é¢†å–æˆåŠŸï¼è·å¾— ${Ia(s.totalStones)} ç„°æ™¶`),la.spiritStones=s.newSpiritStones,Ma()}catch{ta.error("é¢†å–å¤±è´¥")}finally{fa.value=!1}}function Ja(){const a="https:"===location.protocol?"wss:":"ws:";_a=new WebSocket(`${a}//${location.host}/ws`),_a.onopen=()=>{ya.value=!0,ja&&_a.send(JSON.stringify({type:"auth",token:ja,name:la.name}))},_a.onmessage=a=>{try{const s=JSON.parse(a.data);if("boss_hit"===s.type){const a=s.data;pa.value.push({playerName:a.playerName,damage:a.damage,isCrit:a.isCrit}),pa.value.length>30&&pa.value.shift(),na.value&&(na.value.currentHp=a.bossHp),u(()=>{ha.value&&(ha.value.scrollTop=ha.value.scrollHeight)})}if("boss_dead"===s.type){const a=s.data;ta.success(`ğŸ‰ ${a.bossName} å·²è¢«å‡»æ€ï¼æœ€å¤§åŠŸè‡£: ${a.killerName}`),na.value&&(na.value.status="dead");try{w.victory()}catch{}Ma(),Oa()}if("boss_spawn"===s.type){const a=s.data;ta.info(`ğŸ‰ é»‘ç„°å…¥ä¾µã€${a.bossName}ã€‘é™ä¸´äº†ï¼`),Wa(),La(),pa.value=[]}}catch{}},_a.onclose=()=>{ya.value=!1,wa=setTimeout(Ja,3e3)},_a.onerror=()=>{_a.close()}}return a(()=>{Wa(),La(),Ma(),Oa(),Ja()}),s(()=>{wa&&clearTimeout(wa),xa&&clearInterval(xa),_a&&(_a.onclose=null,_a.close())}),(a,s)=>{const u=j,c=C,h=H,k=z,_=$;return d(),e("div",T,[l(x,null,{default:t(()=>[...s[0]||(s[0]=[r("p",null,[v("ğŸ‰ "),r("strong",null,"ä¸–ç•ŒBoss"),v("å®šæ—¶é™ä¸´ï¼Œå…¨æœç©å®¶ååŠ›å‡»æ€")],-1),r("p",null,[v("âš”ï¸ æ¯æ¬¡æ”»å‡»æ¶ˆè€—"),r("strong",null,"10ç„°çµ"),v("ï¼Œå†·å´3ç§’")],-1),r("p",null,[v("ğŸ† æŒ‰"),r("strong",null,"ä¼¤å®³æ’å"),v("å‘æ”¾ç„°æ™¶å¥–åŠ±")],-1),r("p",null,"â° é™æ—¶å¼€æ”¾ï¼ŒBossè¢«å‡»æ€åå¯é¢†å–å¥–åŠ±",-1)])]),_:1}),na.value?(d(),e(n,{key:1},[l(c,{class:"boss-card boss-main"},{default:t(()=>[r("div",N,[r("div",B,[$a(na.value.name)?(d(),e("img",{key:0,src:$a(na.value.name),class:"boss-avatar",loading:"lazy"},null,8,I)):(d(),e("span",F,"ğŸ‰")),r("span",W,m(na.value.name),1),l(h,{type:"warning",size:"small"},{default:t(()=>[v("Lv."+m(na.value.level),1)]),_:1}),l(h,{type:"active"===na.value.status?"error":"default",size:"small",style:{"margin-left":"6px"}},{default:t(()=>[v(m("active"===na.value.status?"âš”ï¸ æˆ˜æ–—ä¸­":"dead"===na.value.status?"ğŸ’€ å·²å‡»æ€":"â³ ç­‰å¾…ä¸­"),1)]),_:1},8,["type"])]),l(h,{type:ya.value?"success":"error",size:"tiny"},{default:t(()=>[v(m(ya.value?"å®æ—¶è¿æ¥":"æœªè¿æ¥"),1)]),_:1},8,["type"])]),r("p",L,m(na.value.description),1),r("div",M,[r("div",O,[r("div",{class:"hp-bar-fill",style:y({width:Ta.value+"%"})},null,4)]),r("div",D,m(Ia(na.value.currentHp))+" / "+m(Ia(na.value.maxHp))+" ("+m(Ta.value.toFixed(1))+"%)",1)]),r("div",G,[l(h,{size:"small"},{default:t(()=>[v("æ”»å‡»: "+m(na.value.attack),1)]),_:1}),l(h,{size:"small"},{default:t(()=>[v("é˜²å¾¡: "+m(na.value.defense),1)]),_:1}),l(h,{size:"small"},{default:t(()=>[v("å‚ä¸: "+m(ua.value)+"äºº",1)]),_:1})])]),_:1}),r("div",J,[r("div",P,[l(c,{class:"boss-card attack-card"},{default:t(()=>[r("div",Y,[r("div",{class:"damage-float-container",ref_key:"floatContainer",ref:ka},[l(g,{name:"float"},{default:t(()=>[(d(!0),e(n,null,p(ma.value,a=>(d(),e("div",{key:a.id,class:f(["damage-float",{crit:a.isCrit}]),style:y({left:a.x+"px"})},m(a.isCrit?"æš´å‡»! ":"")+"-"+m(Ia(a.damage)),7))),128))]),_:1})],512),l(_,{type:"error",size:"large",disabled:!Na.value||"active"!==na.value.status,loading:ga.value,onClick:Da,class:"attack-btn"},{default:t(()=>[v(m(ba.value>0?`å†·å´ä¸­ (${ba.value}s)`:"âš”ï¸ å‡ºæ‰‹æ”»å‡»"),1)]),_:1},8,["disabled","loading"]),s[5]||(s[5]=r("div",{class:"attack-cost"},"æ¶ˆè€—: 10 ç„°çµ/æ¬¡",-1)),oa.value>0?(d(),e("div",A,[s[3]||(s[3]=v(" æˆ‘çš„ä¼¤å®³: ",-1)),r("span",R,m(Ia(oa.value)),1),s[4]||(s[4]=v(" | æ’å: ",-1)),r("span",q,"#"+m(ra.value),1),v(" | æ”»å‡»: "+m(ia.value)+"æ¬¡ ",1)])):i("",!0)])]),_:1}),l(c,{title:"ğŸ† ä¼¤å®³ç„°æ¦œ",class:"boss-card",style:{"margin-top":"12px"}},{default:t(()=>[l(k,{bordered:!1,size:"small",class:"rank-table"},{default:t(()=>[s[6]||(s[6]=r("thead",null,[r("tr",null,[r("th",null,"æ’å"),r("th",null,"ç©å®¶"),r("th",null,"æ€»ä¼¤å®³"),r("th",null,"æ¬¡æ•°")])],-1)),r("tbody",null,[(d(!0),e(n,null,p(ca.value,a=>(d(),e("tr",{key:a.rank,class:f({"my-row":a.fullWallet===b(Ca)})},[r("td",null,[1===a.rank?(d(),e("span",E,"ğŸ¥‡")):2===a.rank?(d(),e("span",K,"ğŸ¥ˆ")):3===a.rank?(d(),e("span",Q,"ğŸ¥‰")):(d(),e("span",U,m(a.rank),1))]),r("td",null,m(a.name),1),r("td",V,m(Ia(a.damage)),1),r("td",null,m(a.attacks),1)],2))),128))])]),_:1})]),_:1})]),r("div",X,[l(c,{title:"ğŸ“‹ æˆ˜æ–—æ—¥å¿—",class:"boss-card log-card"},{default:t(()=>[r("div",{class:"battle-log",ref_key:"logRef",ref:ha},[(d(!0),e(n,null,p(pa.value,(a,l)=>(d(),e("div",{key:l,class:f(["log-item",{crit:a.isCrit}])},[r("span",Z,m(a.playerName),1),a.isCrit?(d(),e("span",aa,"æš´å‡»ï¼")):i("",!0),s[7]||(s[7]=v(" å¯¹ Boss é€ æˆäº† ",-1)),r("span",{class:f(["log-dmg",{"log-crit-dmg":a.isCrit}])},m(Ia(a.damage)),3),s[8]||(s[8]=v(" ç‚¹ä¼¤å®³ï¼ ",-1))],2))),128)),0===pa.value.length?(d(),e("div",sa,"æš‚æ— æˆ˜æ–—è®°å½•")):i("",!0)],512)]),_:1}),da.value.length?(d(),o(c,{key:0,title:"ğŸ Bosså¥–åŠ±",class:"boss-card",style:{"margin-top":"12px"}},{default:t(()=>[(d(!0),e(n,null,p(da.value,a=>(d(),e("div",{key:a.id,class:"reward-item"},[r("span",null,m(a.bossName)+" - ç¬¬"+m(a.rank)+"å",1),r("span",ea,m(Ia(a.stones))+" ç„°æ™¶",1),a.claimed?(d(),o(h,{key:0,type:"default",size:"small"},{default:t(()=>[...s[9]||(s[9]=[v("å·²é¢†å–",-1)])]),_:1})):i("",!0)]))),128)),l(_,{type:"warning",block:"",onClick:Ga,loading:fa.value,disabled:!Ba.value,style:{"margin-top":"12px"}},{default:t(()=>[v(m(Ba.value?"é¢†å–å…¨éƒ¨å¥–åŠ±":"å·²å…¨éƒ¨é¢†å–"),1)]),_:1},8,["loading","disabled"])]),_:1})):i("",!0)])])],64)):(d(),e(n,{key:0},[l(c,{class:"boss-card"},{default:t(()=>[l(u,{description:"å½“å‰æ— é»‘ç„°å…¥ä¾µï¼Œè¯·ç­‰å¾…ä¸‹æ¬¡é™ä¸´"},{icon:t(()=>[...s[1]||(s[1]=[r("span",{style:{"font-size":"48px"}},"ğŸ‰",-1)])]),_:1})]),_:1}),va.value.length?(d(),o(c,{key:0,title:"ğŸ“œ å†å²è®°å½•",style:{"margin-top":"16px"}},{default:t(()=>[l(k,{bordered:!1,size:"small"},{default:t(()=>[s[2]||(s[2]=r("thead",null,[r("tr",null,[r("th",null,"Boss"),r("th",null,"ç­‰çº§"),r("th",null,"HP"),r("th",null,"çŠ¶æ€"),r("th",null,"æ—¶é—´")])],-1)),r("tbody",null,[(d(!0),e(n,null,p(va.value,a=>(d(),e("tr",{key:a.id},[r("td",null,m(a.name),1),r("td",null,"Lv."+m(a.level),1),r("td",null,m(Ia(a.maxHp)),1),r("td",null,[l(h,{type:"dead"===a.status?"error":"info",size:"small"},{default:t(()=>[v(m("dead"===a.status?"å·²å‡»æ€":"è¿›è¡Œä¸­"),1)]),_:2},1032,["type"])]),r("td",null,m(Fa(a.spawnTime)),1)]))),128))])]),_:1})]),_:1})):i("",!0)],64))])}}},[["__scopeId","data-v-f7f18334"]]);export{la as default};
