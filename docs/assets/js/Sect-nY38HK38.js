import{_ as e,a}from"./index-C_Usn6qf.js";import{G as l}from"./GameGuide-Dc_uhL03.js";import{c as t,e as s,k as n,j as r,L as i,M as u,J as c,B as o,Y as d,F as v,t as m,m as p,p as y,s as f,P as w,Q as g,Z as _,O as h,$ as k}from"./naive-ui-CtewNtT3.js";import{o as b,bn as x,bE as z,r as C,bf as T,bF as O,bh as P,k as S,bg as $,b1 as j,bi as E,F as G,bk as U,bj as L,E as F,q as M}from"./vendor-CBGg7cPT.js";const B={key:0},I={key:1},J={class:"sect-name"},q={class:"info-row"},A={class:"exp-text"},N={class:"info-row"},Q={class:"info-row"},R={class:"info-row"},Y={style:{color:"#d4a017"}},Z={class:"announcement-box"},D={class:"announcement-text"},H={class:"task-reward"},K={class:"task-reward"},V={key:0},W=e({__name:"Sect",setup(e){const W=a(),{message:X}=t(["message"]),ee=C(!1),ae=C(!1),le=C(!1),te=C(!1),se=C(null),ne=C(""),re=C(0),ie=C([]),ue=C([]),ce=C([]),oe=C(""),de=C(1e3),ve=C(""),me=C({name:"",description:""}),pe=[0,1e3,3e3,8e3,2e4,5e4,1e5,2e5,5e5,1e6],ye=M(()=>{if(!se.value)return 1e3;const e=se.value.level||1;return e>=10?pe[9]:pe[e]}),fe=M(()=>se.value?Math.min(100,Math.floor(se.value.exp/ye.value*100)):0),we=M(()=>ue.value.filter(e=>"daily"===e.type)),ge=M(()=>ue.value.filter(e=>"weekly"===e.type));function _e(e){var a;return(e.completed_by||[]).includes(null==(a=W.wallet)?void 0:a.toLowerCase())}function he(e){return"leader"===e?"ç›Ÿä¸»":"elder"===e?"ç„°é•¿":"ç›Ÿå£«"}function ke(e){return"leader"===e?"warning":"elder"===e?"info":"default"}const be=async(e,a,l)=>{const t={method:e,headers:{Authorization:`Bearer ${W.token}`,"Content-Type":"application/json"}};l&&(t.body=JSON.stringify(l));const s=await fetch(`/api${a}`,t),n=await s.json();if(!s.ok)throw new Error(n.error||"è¯·æ±‚å¤±è´¥");return n};async function xe(){try{const e=await be("GET","/sect/my");e.sect?(se.value=e.sect,ne.value=e.myRole,re.value=e.myContribution,ie.value=e.members||[],ve.value=e.sect.announcement||"",await async function(){try{const e=await be("GET","/sect/tasks");ue.value=e.tasks||[]}catch{}}()):(se.value=null,await ze())}catch(e){X.error(e.message)}}async function ze(){te.value=!0;try{const e=await be("GET",`/sect/list?search=${oe.value}&sort=level`);ce.value=e.sects||[]}catch(e){X.error(e.message)}te.value=!1}async function Ce(){if(!me.value.name)return X.warning("è¯·è¾“å…¥ç„°ç›Ÿåç§°");ae.value=!0;try{await be("POST","/sect/create",me.value),X.success("ç„°ç›Ÿåˆ›å»ºæˆåŠŸï¼"),await xe()}catch(e){X.error(e.message)}ae.value=!1}async function Te(){try{await be("POST","/sect/leave"),X.success("å·²é€€å‡ºç„°ç›Ÿ"),se.value=null,await ze()}catch(e){X.error(e.message)}}async function Oe(e){try{const a=await be("POST",`/sect/tasks/${e}/complete`);X.success(`ä»»åŠ¡å®Œæˆï¼è´¡çŒ®+${a.reward_contribution} ç„°æ™¶+${a.reward_stones}`),await xe()}catch(a){X.error(a.message)}}async function Pe(){if(!de.value||de.value<100)return X.warning("æœ€å°‘æçŒ®100ç„°æ™¶");le.value=!0;try{const e=await be("POST","/sect/donate",{amount:de.value});X.success(`æçŒ®æˆåŠŸï¼è´¡çŒ®+${e.contribution}`),await xe()}catch(e){X.error(e.message)}le.value=!1}async function Se(){try{await be("POST","/sect/announcement",{announcement:ve.value}),X.success("å…¬å‘Šå·²æ›´æ–°"),await xe()}catch(e){X.error(e.message)}}async function $e(e){try{await be("POST","/sect/kick",{wallet:e}),X.success("å·²è¸¢å‡º"),await xe()}catch(a){X.error(a.message)}}const je=[{title:"ç„°ç›Ÿ",key:"name"},{title:"ç­‰çº§",key:"level",width:60,render:e=>F(m,{type:"warning",size:"small"},()=>`Lv.${e.level}`)},{title:"æˆå‘˜",key:"member_count",width:70,render:e=>`${e.member_count}/${e.max_members}`},{title:"æ“ä½œ",key:"action",width:80,render:e=>F(o,{size:"tiny",type:"warning",onClick:()=>async function(e){try{await be("POST","/sect/join",{sectId:e}),X.success("åŠ å…¥æˆåŠŸï¼"),await xe()}catch(a){X.error(a.message)}}(e.id)},()=>"åŠ å…¥")}],Ee=M(()=>{const e=[{title:"ç„°å",key:"name",render:e=>e.name||"æ— åç„°ä¿®"},{title:"èº«ä»½",key:"role",width:70,render:e=>F(m,{type:ke(e.role),size:"small"},()=>he(e.role))},{title:"æˆ˜åŠ›",key:"combat_power",width:80,render:e=>e.combat_power||0},{title:"è´¡çŒ®",key:"contribution",width:80}];return"leader"===ne.value?e.push({title:"ç®¡ç†",key:"manage",width:140,render:e=>{if("leader"===e.role)return"";const a=[];return"member"===e.role&&a.push(F(o,{size:"tiny",type:"info",onClick:()=>async function(e){try{await be("POST","/sect/promote",{wallet:e}),X.success("å·²å‡ä¸ºç„°é•¿"),await xe()}catch(a){X.error(a.message)}}(e.wallet),style:"margin-right:4px"},()=>"å‡èŒ")),"elder"===e.role&&a.push(F(o,{size:"tiny",type:"warning",onClick:()=>async function(e){try{await be("POST","/sect/demote",{wallet:e}),X.success("å·²é™ä¸ºç›Ÿå£«"),await xe()}catch(a){X.error(a.message)}}(e.wallet),style:"margin-right:4px"},()=>"é™èŒ")),a.push(F(o,{size:"tiny",type:"error",onClick:()=>$e(e.wallet)},()=>"è¸¢å‡º")),F("div",{},a)}}):"elder"===ne.value&&e.push({title:"ç®¡ç†",key:"manage",width:80,render:e=>"member"!==e.role?"":F(o,{size:"tiny",type:"error",onClick:()=>$e(e.wallet)},()=>"è¸¢å‡º")}),e});return b(async()=>{ee.value=!0,await xe(),ee.value=!1}),(e,a)=>{const t=c,b=u,C=i,F=r,M=d,W=n,X=v,ue=p,pe=_,be=g,xe=w,$e=f,Ge=y,Ue=h,Le=k,Fe=s;return T(),x(Fe,{show:ee.value},{default:z(()=>[O(l,null,{default:z(()=>[...a[5]||(a[5]=[P("p",null,[S("ğŸ¯ åˆ›å»ºç„°ç›Ÿéœ€"),P("strong",null,"50,000ç„°æ™¶"),S("ï¼Œæˆ–æœç´¢åŠ å…¥å·²æœ‰ç„°ç›Ÿ")],-1),P("p",null,"ğŸ“ˆ ç„°ç›Ÿæœ‰ç­‰çº§ç³»ç»Ÿï¼Œç­‰çº§è¶Šé«˜åŠ æˆè¶Šå¼º",-1),P("p",null,[S("ğŸ å®Œæˆç„°ç›Ÿä»»åŠ¡è·å¾—"),P("strong",null,"è´¡çŒ®åº¦+ç„°æ™¶")],-1),P("p",null,"ğŸ’° æçŒ®ç„°æ™¶ï¼šæ¯10ç„°æ™¶=1è´¡çŒ®åº¦ï¼Œç„°æ™¶è½¬ä¸ºç„°ç›Ÿç»éªŒ",-1),P("p",null,"ğŸ‘‘ èŒä½ï¼šç›Ÿä¸»â†’ç„°é•¿â†’ç›Ÿå£«ï¼Œä¸åŒæƒé™",-1)])]),_:1}),se.value?(T(),$("div",I,[O(W,{vertical:"",size:16},{default:z(()=>[O(F,{class:"gold-card"},{header:z(()=>[O(W,{align:"center"},{default:z(()=>[a[7]||(a[7]=P("span",{style:{"font-size":"20px"}},"ğŸ¯",-1)),P("span",J,E(se.value.name),1),O(j(m),{type:"warning",size:"small"},{default:z(()=>[S("Lv."+E(se.value.level),1)]),_:1})]),_:1})]),default:z(()=>[O(W,{vertical:"",size:8},{default:z(()=>[P("div",q,[a[8]||(a[8]=P("span",{class:"label"},"ç»éªŒ:",-1)),O(X,{type:"line",percentage:fe.value,"show-indicator":!0,"indicator-placement":"inside",color:"#d4a017","rail-color":"#333"},null,8,["percentage"]),P("span",A,E(se.value.exp)+" / "+E(ye.value),1)]),P("div",N,[a[9]||(a[9]=P("span",{class:"label"},"æˆå‘˜:",-1)),P("span",null,E(ie.value.length)+" / "+E(se.value.max_members),1)]),P("div",Q,[a[10]||(a[10]=P("span",{class:"label"},"æˆ‘çš„èº«ä»½:",-1)),O(j(m),{type:ke(ne.value),size:"small"},{default:z(()=>[S(E(he(ne.value)),1)]),_:1},8,["type"])]),P("div",R,[a[11]||(a[11]=P("span",{class:"label"},"æˆ‘çš„è´¡çŒ®:",-1)),P("span",Y,E(re.value),1)]),O(ue,{style:{margin:"8px 0"}}),P("div",Z,[a[12]||(a[12]=P("div",{class:"label"},"ğŸ“¢ å…¬å‘Š",-1)),P("div",D,E(se.value.announcement||"æš‚æ— å…¬å‘Š"),1)])]),_:1})]),_:1}),O(F,{title:"ğŸ“‹ ç„°ç›Ÿä»»åŠ¡",class:"gold-card"},{default:z(()=>[O(Ge,{type:"segment",animated:""},{default:z(()=>[O($e,{name:"daily",tab:"æ¯æ—¥ä»»åŠ¡"},{default:z(()=>[O(xe,{bordered:""},{default:z(()=>[(T(!0),$(G,null,U(we.value,e=>(T(),x(be,{key:e.id},{default:z(()=>[O(pe,{title:e.title,description:e.description},{"header-extra":z(()=>[_e(e)?(T(),x(j(m),{key:0,type:"success",size:"small"},{default:z(()=>[...a[13]||(a[13]=[S("å·²å®Œæˆ",-1)])]),_:1})):(T(),x(j(o),{key:1,size:"small",type:"warning",onClick:a=>Oe(e.id)},{default:z(()=>[...a[14]||(a[14]=[S("å®Œæˆ",-1)])]),_:1},8,["onClick"]))]),_:2},1032,["title","description"]),P("div",H,"è´¡çŒ®+"+E(e.reward_contribution)+" ç„°æ™¶+"+E(e.reward_stones),1)]),_:2},1024))),128))]),_:1})]),_:1}),O($e,{name:"weekly",tab:"æ¯å‘¨ä»»åŠ¡"},{default:z(()=>[O(xe,{bordered:""},{default:z(()=>[(T(!0),$(G,null,U(ge.value,e=>(T(),x(be,{key:e.id},{default:z(()=>[O(pe,{title:e.title,description:e.description},{"header-extra":z(()=>[_e(e)?(T(),x(j(m),{key:0,type:"success",size:"small"},{default:z(()=>[...a[15]||(a[15]=[S("å·²å®Œæˆ",-1)])]),_:1})):(T(),x(j(o),{key:1,size:"small",type:"warning",onClick:a=>Oe(e.id)},{default:z(()=>[...a[16]||(a[16]=[S("å®Œæˆ",-1)])]),_:1},8,["onClick"]))]),_:2},1032,["title","description"]),P("div",K,"è´¡çŒ®+"+E(e.reward_contribution)+" ç„°æ™¶+"+E(e.reward_stones),1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1}),O(F,{title:"ğŸ’° æçŒ®ç„°æ™¶",class:"gold-card"},{default:z(()=>[O(W,null,{default:z(()=>[O(Ue,{value:de.value,"onUpdate:value":a[3]||(a[3]=e=>de.value=e),min:100,step:1e3,placeholder:"æœ€å°‘100",style:{width:"180px"}},null,8,["value"]),O(j(o),{type:"warning",onClick:Pe,loading:le.value},{default:z(()=>[...a[17]||(a[17]=[S("æçŒ®",-1)])]),_:1},8,["loading"])]),_:1}),a[18]||(a[18]=P("div",{style:{"margin-top":"8px",color:"#888","font-size":"12px"}},"æ¯10ç„°æ™¶=1è´¡çŒ®åº¦ï¼Œç„°æ™¶å…¨éƒ¨è½¬ä¸ºç„°ç›Ÿç»éªŒ",-1))]),_:1}),O(F,{title:"ğŸ‘¥ æˆå‘˜åˆ—è¡¨",class:"gold-card"},{default:z(()=>[O(M,{columns:Ee.value,data:ie.value,bordered:!1,size:"small"},null,8,["columns","data"])]),_:1}),"leader"===ne.value||"elder"===ne.value?(T(),x(F,{key:0,title:"âš™ï¸ ç®¡ç†",class:"gold-card"},{default:z(()=>[O(W,{vertical:"",size:12},{default:z(()=>["leader"===ne.value||"elder"===ne.value?(T(),$("div",V,[a[20]||(a[20]=P("div",{class:"label",style:{"margin-bottom":"4px"}},"ä¿®æ”¹å…¬å‘Š",-1)),O(W,null,{default:z(()=>[O(t,{value:ve.value,"onUpdate:value":a[4]||(a[4]=e=>ve.value=e),placeholder:"æ–°å…¬å‘Š(æœ€å¤š200å­—)",maxlength:"200",style:{width:"260px"}},null,8,["value"]),O(j(o),{type:"warning",size:"small",onClick:Se},{default:z(()=>[...a[19]||(a[19]=[S("æ›´æ–°",-1)])]),_:1})]),_:1})])):L("",!0)]),_:1})]),_:1})):L("",!0),O(F,{class:"gold-card"},{default:z(()=>[O(Le,{onPositiveClick:Te},{trigger:z(()=>[O(j(o),{type:"error",ghost:""},{default:z(()=>[...a[21]||(a[21]=[S("é€€å‡ºç„°ç›Ÿ",-1)])]),_:1})]),default:z(()=>[a[22]||(a[22]=S(" ç¡®å®šé€€å‡ºç„°ç›Ÿï¼Ÿè´¡çŒ®åº¦å°†æ¸…é›¶ï¼ ",-1))]),_:1})]),_:1})]),_:1})])):(T(),$("div",B,[O(W,{vertical:"",size:16},{default:z(()=>[O(F,{title:"ğŸ¯ åˆ›å»ºç„°ç›Ÿ",class:"gold-card"},{default:z(()=>[O(C,{model:me.value,"label-placement":"left","label-width":"80"},{default:z(()=>[O(b,{label:"ç„°ç›Ÿå"},{default:z(()=>[O(t,{value:me.value.name,"onUpdate:value":a[0]||(a[0]=e=>me.value.name=e),placeholder:"2-20å­—",maxlength:"20"},null,8,["value"])]),_:1}),O(b,{label:"ç®€ä»‹"},{default:z(()=>[O(t,{value:me.value.description,"onUpdate:value":a[1]||(a[1]=e=>me.value.description=e),type:"textarea",placeholder:"ç„°ç›Ÿç®€ä»‹(å¯é€‰)",maxlength:"100"},null,8,["value"])]),_:1}),O(b,null,{default:z(()=>[O(j(o),{type:"warning",onClick:Ce,loading:ae.value},{default:z(()=>[...a[6]||(a[6]=[S(" åˆ›å»ºç„°ç›Ÿ (æ¶ˆè€— 50000 ç„°æ™¶) ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),O(F,{title:"ğŸ“œ ç„°ç›Ÿåˆ—è¡¨",class:"gold-card"},{"header-extra":z(()=>[O(t,{value:oe.value,"onUpdate:value":[a[2]||(a[2]=e=>oe.value=e),ze],placeholder:"æœç´¢ç„°ç›Ÿ",size:"small",style:{width:"160px"},clearable:""},null,8,["value"])]),default:z(()=>[O(M,{columns:je,data:ce.value,bordered:!1,size:"small",loading:te.value},null,8,["data","loading"])]),_:1})]),_:1})]))]),_:1},8,["show"])}}},[["__scopeId","data-v-7c3566d3"]]);export{W as default};
