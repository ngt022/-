import{_ as e,u as t}from"./index-DkhJWZ0D.js";import{s as a}from"./sfx-Bhf_myqE.js";import{G as s}from"./GameGuide-Sg6BGPLx.js";import{u as l,j as n,k as o,t as i,H as r,B as u,F as d,v as c}from"./naive-ui-CtewNtT3.js";import{o as p,aC as f,bg as v,bF as y,bE as _,r as g,bf as h,bh as m,k as b,bi as x,bn as k,F as z,bk as w,aW as M,bj as j,q as D}from"./vendor-CBGg7cPT.js";const $={class:"events-page"},S={class:"evt-header"},B={class:"evt-icon"},I={class:"evt-title-area"},T={class:"evt-countdown"},C={class:"evt-body"},F={key:0,class:"evt-effect"},G={key:1,class:"evt-effect"},P={key:2,class:"evt-effect"},R={key:3,class:"evt-effect"},E={key:4,class:"evt-effect"},H={class:"evt-progress"},q=e({__name:"Events",setup(e){const q=l(),A=t(),O=g([]),U=g(null),W=g(new Set);let J=null;const K=D(()=>{if(!U.value)return!1;const e=U.value;return e.cultivationMultiplier>1||e.gachaRateBoost>1||e.dropMultiplier>1||e.shopDiscount<1}),L=async()=>{try{const[e,t]=await Promise.all([fetch("/api/events/active"),fetch("/api/events/effects")]),a=await e.json(),s=await t.json();O.value=a.events||[],U.value=s.effects||null}catch{}},N=e=>({double_cultivation:"#7c5cbf",gacha_rate_up:"#4caf50",double_drop:"#42a5f5",discount:"#e53935",login_bonus:"#d4a843"}[e]||"#d4a843"),Q=e=>{const t=new Date(e.starts_at).getTime(),a=new Date(e.ends_at).getTime(),s=Date.now();return s>=a?100:s<=t?0:Math.round((s-t)/(a-t)*100)},V=e=>{const t=new Date(e).getTime()-Date.now();if(t<=0)return"å·²ç»“æŸ";const a=Math.floor(t/864e5),s=Math.floor(t%864e5/36e5),l=Math.floor(t%36e5/6e4);return a>0?`å‰©ä½™ ${a}å¤©${s}æ—¶`:`å‰©ä½™ ${s}æ—¶${l}åˆ†`},X=e=>{const t=new Date(e);return`${t.getMonth()+1}/${t.getDate()} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`};return p(()=>{L(),J=setInterval(L,6e4)}),f(()=>{J&&clearInterval(J)}),(e,t)=>{const l=i,p=o,f=r,g=u,D=d,J=c,L=n;return h(),v("div",$,[y(s,null,{default:_(()=>[...t[0]||(t[0]=[m("p",null,[b("ğŸ‰ æœåŠ¡ç«¯é…ç½®çš„"),m("strong",null,"é™æ—¶æ´»åŠ¨"),b("ï¼Œä¸å®šæœŸå¼€æ”¾")],-1),m("p",null,"ğŸ”¥ æ´»åŠ¨ç±»å‹ï¼šåŒå€å†¥æƒ³ã€æŠ½å¡æ¦‚ç‡UPã€åŒå€æ‰è½ã€å•†é“ºæŠ˜æ‰£ç­‰",-1),m("p",null,[b("ğŸ æ´»åŠ¨æœŸé—´å¯é¢†å–"),m("strong",null,"é™æ—¶å¥–åŠ±")],-1),m("p",null,"â° æ³¨æ„æ´»åŠ¨æ—¶é—´ï¼Œè¿‡æœŸä¸å€™ï¼",-1)])]),_:1}),y(L,null,{default:_(()=>[y(p,{justify:"end",style:{"margin-bottom":"8px"}},{default:_(()=>[y(l,{type:"warning",size:"small"},{default:_(()=>[b(x(O.value.length)+" ä¸ªè¿›è¡Œä¸­",1)]),_:1})]),_:1}),O.value.length>0?(h(),k(p,{key:0,vertical:"",size:16},{default:_(()=>[(h(!0),v(z,null,w(O.value,e=>{return h(),v("div",{key:e.id,class:M(["event-card","evt-type-"+e.type])},[m("div",S,[m("span",B,x((s=e.type,{double_cultivation:"âš¡",gacha_rate_up:"ğŸ´",double_drop:"ğŸ’",discount:"ğŸ·ï¸",login_bonus:"ğŸ"}[s]||"ğŸ‰")),1),m("div",I,[y(f,{strong:"",style:{"font-size":"16px"}},{default:_(()=>[b(x(e.name),1)]),_:2},1024),y(f,{depth:"3",style:{"font-size":"12px"}},{default:_(()=>[b(x(e.description),1)]),_:2},1024)]),m("div",T,[y(f,{type:"warning",style:{"font-size":"12px"}},{default:_(()=>[b(x(V(e.ends_at)),1)]),_:2},1024)])]),m("div",C,["double_cultivation"===e.type?(h(),v("div",F,[y(l,{type:"success",size:"small"},{default:_(()=>{var t;return[b("ç„°åŠ› x"+x((null==(t=e.config)?void 0:t.multiplier)||2),1)]}),_:2},1024),y(f,{depth:"3",style:{"font-size":"12px"}},{default:_(()=>[...t[1]||(t[1]=[b("å†¥æƒ³ã€æ¢ç´¢è·å¾—çš„ç„°åŠ›ç¿»å€",-1)])]),_:1})])):j("",!0),"gacha_rate_up"===e.type?(h(),v("div",G,[y(l,{type:"info",size:"small"},{default:_(()=>{var t;return[b("ç¨€æœ‰æ¦‚ç‡ +"+x(Math.round(100*(((null==(t=e.config)?void 0:t.rateBoost)||1.5)-1)))+"%",1)]}),_:2},1024),y(f,{depth:"3",style:{"font-size":"12px"}},{default:_(()=>[...t[2]||(t[2]=[b("ç´«è‰²åŠä»¥ä¸Šå“è´¨å‡ºç‡æå‡",-1)])]),_:1})])):j("",!0),"login_bonus"===e.type?(h(),v("div",P,[y(l,{type:"warning",size:"small"},{default:_(()=>{var t;return[b("æ¯æ—¥ "+x((null==(t=e.config)?void 0:t.dailyStones)||2e3)+" ç„°æ™¶",1)]}),_:2},1024),y(g,{size:"small",type:"primary",disabled:W.value.has(e.id),onClick:t=>(async e=>{try{const t=localStorage.getItem("xx_token")||localStorage.getItem("roon_auth_token"),s=await fetch(`/api/events/${e.id}/claim`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}}),l=await s.json();l.ok?(W.value.add(e.id),a.purchase(),q.success(`é¢†å–æˆåŠŸï¼è·å¾— ${l.stones} ç„°æ™¶`),A.spiritStones+=l.stones,A.saveData()):q.warning(l.error||"é¢†å–å¤±è´¥")}catch{q.error("ç½‘ç»œé”™è¯¯")}})(e),style:{"margin-left":"8px"}},{default:_(()=>[b(x(W.value.has(e.id)?"å·²é¢†å–":"é¢†å–å¥–åŠ±"),1)]),_:2},1032,["disabled","onClick"])])):j("",!0),"double_drop"===e.type?(h(),v("div",R,[y(l,{type:"success",size:"small"},{default:_(()=>{var t;return[b("æ‰è½ x"+x((null==(t=e.config)?void 0:t.multiplier)||2),1)]}),_:2},1024),y(f,{depth:"3",style:{"font-size":"12px"}},{default:_(()=>[...t[3]||(t[3]=[b("ç„šå¤©å¡”ã€æ¢ç´¢æ‰è½ç¿»å€",-1)])]),_:1})])):j("",!0),"discount"===e.type?(h(),v("div",E,[y(l,{type:"error",size:"small"},{default:_(()=>{var t;return[b(x(Math.round(100*((null==(t=e.config)?void 0:t.discount)||.8))/10)+"æŠ˜",1)]}),_:2},1024),y(f,{depth:"3",style:{"font-size":"12px"}},{default:_(()=>[...t[4]||(t[4]=[b("ç„°æ™¶å•†é“ºå…¨åœºé™æ—¶æŠ˜æ‰£",-1)])]),_:1})])):j("",!0)]),m("div",H,[y(D,{type:"line",percentage:Q(e),color:N(e.type),"rail-color":"rgba(255,255,255,0.05)",height:4,"show-indicator":!1},null,8,["percentage","color"]),y(f,{depth:"3",style:{"font-size":"10px"}},{default:_(()=>[b(x(X(e.starts_at))+" â€” "+x(X(e.ends_at)),1)]),_:2},1024)])],2);var s}),128))]),_:1})):(h(),k(J,{key:1,description:"æš‚æ— è¿›è¡Œä¸­çš„æ´»åŠ¨",style:{padding:"40px 0"}},{icon:_(()=>[...t[5]||(t[5]=[m("span",{style:{"font-size":"40px"}},"ğŸ",-1)])]),_:1})),U.value&&K.value?(h(),k(L,{key:2,title:"âš¡ å½“å‰ç”Ÿæ•ˆ",size:"small",style:{"margin-top":"16px"},bordered:!1,class:"effects-card"},{default:_(()=>[y(p,{size:8,wrap:""},{default:_(()=>[U.value.cultivationMultiplier>1?(h(),k(l,{key:0,type:"success"},{default:_(()=>[b("ç„°åŠ› x"+x(U.value.cultivationMultiplier),1)]),_:1})):j("",!0),U.value.gachaRateBoost>1?(h(),k(l,{key:1,type:"info"},{default:_(()=>[b("æŠ½å¡æ¦‚ç‡ +"+x(Math.round(100*(U.value.gachaRateBoost-1)))+"%",1)]),_:1})):j("",!0),U.value.dropMultiplier>1?(h(),k(l,{key:2,type:"success"},{default:_(()=>[b("æ‰è½ x"+x(U.value.dropMultiplier),1)]),_:1})):j("",!0),U.value.shopDiscount<1?(h(),k(l,{key:3,type:"error"},{default:_(()=>[b("ç„°æ™¶å•†é“º "+x(Math.round(100*U.value.shopDiscount)/10)+"æŠ˜",1)]),_:1})):j("",!0)]),_:1})]),_:1})):j("",!0)]),_:1})])}}},[["__scopeId","data-v-1a25966d"]]);export{q as default};
