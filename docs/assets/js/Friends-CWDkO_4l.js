import{o as e,bg as a,bF as l,bE as s,r as i,bf as t,bh as n,k as r,bj as d,F as c,bk as o,aW as u,bi as v,bl as f,bn as p,b7 as y,q as m}from"./vendor-CBGg7cPT.js";import{_ as g,a as h}from"./index-DkhJWZ0D.js";import{G as w}from"./GameGuide-Sg6BGPLx.js";import{c as b,j as k,q as _,p as j,s as C,B as O,$ as P,I as q,J as S,t as x,m as z,L as T,M as L,w as J,O as N}from"./naive-ui-CtewNtT3.js";const U={class:"friends-page"},F={class:"friend-count"},I={key:0,class:"empty-tip"},$={class:"friend-grid"},V={class:"friend-info"},A={class:"friend-name"},G={class:"friend-detail"},B={class:"friend-detail"},E={class:"friend-actions"},K={key:0,class:"empty-tip"},M={class:"friend-grid"},W={class:"friend-info"},D={class:"friend-name"},H={class:"friend-detail"},Q={class:"friend-detail"},R={class:"friend-actions"},X={key:0,class:"friend-grid",style:{"margin-top":"12px"}},Y={class:"friend-info"},Z={class:"friend-name"},ee={class:"friend-detail"},ae={class:"friend-detail"},le={class:"friend-actions"},se={key:0,class:"empty-tip"},ie={class:"friend-grid"},te={class:"friend-info"},ne={class:"friend-name"},re={class:"friend-detail"},de={key:0,class:"friend-detail gift-msg"},ce={class:"friend-actions"},oe={key:0,class:"profile-modal"},ue={class:"profile-row"},ve={class:"profile-row"},fe={class:"profile-row"},pe={class:"profile-row"},ye={class:"profile-row"},me={key:0,class:"profile-row"},ge={key:1,class:"profile-row"},he={key:2},we={class:"equip-slot"},be={key:3,class:"empty-tip"},ke={class:"gift-remaining"},_e="/api/friend",je=g({__name:"Friends",setup(g){const{message:je}=b(["message"]),Ce=h(),Oe=i("list"),Pe=i([]),qe=i([]),Se=i(""),xe=i([]),ze=i(!1),Te=i([]),Le=i(!1),Je=i(null),Ne=i(!1),Ue=i(null),Fe=i(!1),Ie=i(3),$e=i({gift_type:"spirit_stones",gift_value:100,message:""}),Ve=[{label:"ç„°æ™¶",value:"spirit_stones"}],Ae=m(()=>qe.value.length?`ç”³è¯·(${qe.value.length})`:"ç”³è¯·"),Ge=m(()=>{const e=Te.value.filter(e=>!e.claimed).length;return e?`ç¤¼ç‰©(${e})`:"ç¤¼ç‰©"}),Be=m(()=>{var e;if(!(null==(e=Je.value)?void 0:e.equippedArtifacts))return[];const a=Je.value.equippedArtifacts,l={weapon:"ç„°æ–",armor:"é˜²å…·",accessory:"é¥°å“",mount:"ç„°éª‘"},s={common:"#aaa",rare:"#4fc3f7",epic:"#ab47bc",legendary:"#ffa726",mythic:"#ef5350"};return Object.entries(a).filter(([,e])=>e).map(([e,a])=>({slot:l[e]||e,name:a.name||"æœªçŸ¥",color:s[a.rarity]||"#ccc"}))});function Ee(){return{Authorization:"Bearer "+Ce.token,"Content-Type":"application/json"}}async function Ke(){try{const e=await fetch(_e+"/list",{headers:Ee()}),a=await e.json();a.ok&&(Pe.value=a.friends)}catch{}}async function Me(){try{const e=await fetch(_e+"/requests",{headers:Ee()}),a=await e.json();a.ok&&(qe.value=a.requests)}catch{}}async function We(){try{const e=await fetch(_e+"/gifts",{headers:Ee()}),a=await e.json();a.ok&&(Te.value=a.gifts)}catch{}}async function De(){if(Se.value.trim()){ze.value=!0;try{const e=await fetch(_e+"/search",{method:"POST",headers:Ee(),body:JSON.stringify({keyword:Se.value})}),a=await e.json();a.ok&&(xe.value=a.players)}catch{}finally{ze.value=!1}}}function He(e){Ue.value=e,$e.value={gift_type:"spirit_stones",gift_value:100,message:""},Ne.value=!0}async function Qe(){Fe.value=!0;try{const e=await fetch(_e+"/gift",{method:"POST",headers:Ee(),body:JSON.stringify({to_wallet:Ue.value.wallet,...$e.value})}),a=await e.json();a.ok?(je.success("ç¤¼ç‰©å·²é€å‡º"),Ie.value=a.remaining,Ne.value=!1,Ke()):je.warning(a.error)}catch{}finally{Fe.value=!1}}function Re(e){return e>=1e4?(e/1e4).toFixed(1)+"ä¸‡":String(e)}function Xe(e){return"spirit_stones"===e?"ç„°æ™¶":e}return e(()=>{Ce.isLoggedIn&&(Ke(),Me(),We())}),(e,i)=>{const m=O,g=P,h=C,b=S,Ce=q,Ye=x,Ze=j,ea=k,aa=z,la=_,sa=L,ia=J,ta=N,na=T;return t(),a("div",U,[l(w,null,{default:s(()=>[...i[8]||(i[8]=[n("p",null,[r("ğŸ‘¥ æœ€å¤šæ·»åŠ "),n("strong",null,"50ä¸ªç„°å‹")],-1),n("p",null,"ğŸ” æœç´¢ç„°å·æ·»åŠ å¥½å‹",-1),n("p",null,"ğŸ‘€ æŸ¥çœ‹ç„°å‹è¯¦æƒ…ï¼šç­‰çº§ã€å¢ƒç•Œã€æˆ˜åŠ›ã€è£…å¤‡ã€ç„°ç›Ÿ",-1),n("p",null,[r("ğŸ æ¯æ—¥å¯"),n("strong",null,"é€ç¤¼3æ¬¡"),r("ï¼ˆç„°æ™¶ï¼‰ï¼Œä¹Ÿå¯é¢†å–å¥½å‹ç¤¼ç‰©")],-1)])]),_:1}),l(ea,{class:"main-card",bordered:!1},{header:s(()=>[i[9]||(i[9]=n("div",{class:"page-title"},"âš”ï¸ ç„°å‹ç³»ç»Ÿ",-1)),n("div",F,"ç„°å‹: "+v(Pe.value.length)+"/50",1)]),default:s(()=>[l(Ze,{value:Oe.value,"onUpdate:value":i[1]||(i[1]=e=>Oe.value=e),type:"line",animated:""},{default:s(()=>[l(h,{name:"list",tab:"ç„°å‹åˆ—è¡¨"},{default:s(()=>[0===Pe.value.length?(t(),a("div",I,"æš‚æ— ç„°å‹ï¼Œå¿«å»æœç´¢æ·»åŠ å§~")):d("",!0),n("div",$,[(t(!0),a(c,null,o(Pe.value,e=>(t(),a("div",{key:e.wallet,class:"friend-card"},[n("div",V,[n("div",A,[n("span",{class:u(["online-dot",{online:e.online}])},null,2),r(" "+v(e.name),1)]),n("div",G,"Lv."+v(e.level)+" Â· "+v(e.realm),1),n("div",B,"æˆ˜åŠ›: "+v(Re(e.combatPower)),1)]),n("div",E,[l(m,{size:"tiny",type:"info",quaternary:"",onClick:a=>async function(e){try{const a=await fetch(_e+"/profile/"+e,{headers:Ee()}),l=await a.json();l.ok?(Je.value=l.profile,Le.value=!0):je.warning(l.error)}catch{}}(e.wallet)},{default:s(()=>[...i[10]||(i[10]=[r("è¯¦æƒ…",-1)])]),_:1},8,["onClick"]),l(m,{size:"tiny",type:"warning",quaternary:"",onClick:a=>He(e)},{default:s(()=>[...i[11]||(i[11]=[r("é€ç¤¼",-1)])]),_:1},8,["onClick"]),l(g,{onPositiveClick:a=>async function(e){try{const a=await fetch(_e+"/remove",{method:"POST",headers:Ee(),body:JSON.stringify({wallet:e})}),l=await a.json();l.ok?(je.success("å·²åˆ é™¤ç„°å‹"),Ke()):je.warning(l.error)}catch{}}(e.wallet)},{trigger:s(()=>[l(m,{size:"tiny",type:"error",quaternary:""},{default:s(()=>[...i[12]||(i[12]=[r("åˆ é™¤",-1)])]),_:1})]),default:s(()=>[r(" ç¡®å®šåˆ é™¤ç„°å‹ã€"+v(e.name)+"ã€‘ï¼Ÿ ",1)]),_:2},1032,["onPositiveClick"])])]))),128))])]),_:1}),l(h,{name:"requests",tab:Ae.value},{default:s(()=>[0===qe.value.length?(t(),a("div",K,"æš‚æ— ç„°å‹ç”³è¯·")):d("",!0),n("div",M,[(t(!0),a(c,null,o(qe.value,e=>(t(),a("div",{key:e.id,class:"friend-card"},[n("div",W,[n("div",D,v(e.name),1),n("div",H,"Lv."+v(e.level)+" Â· "+v(e.realm),1),n("div",Q,"æˆ˜åŠ›: "+v(Re(e.combatPower)),1)]),n("div",R,[l(m,{size:"tiny",type:"success",onClick:a=>async function(e){try{const a=await fetch(_e+"/accept",{method:"POST",headers:Ee(),body:JSON.stringify({friendship_id:e})}),l=await a.json();l.ok?(je.success("å·²æ¥å—"),Me(),Ke()):je.warning(l.error)}catch{}}(e.id)},{default:s(()=>[...i[13]||(i[13]=[r("æ¥å—",-1)])]),_:1},8,["onClick"]),l(m,{size:"tiny",type:"error",quaternary:"",onClick:a=>async function(e){try{const a=await fetch(_e+"/reject",{method:"POST",headers:Ee(),body:JSON.stringify({friendship_id:e})}),l=await a.json();l.ok?(je.success("å·²æ‹’ç»"),Me()):je.warning(l.error)}catch{}}(e.id)},{default:s(()=>[...i[14]||(i[14]=[r("æ‹’ç»",-1)])]),_:1},8,["onClick"])])]))),128))])]),_:1},8,["tab"]),l(h,{name:"search",tab:"æœç´¢æ·»åŠ "},{default:s(()=>[l(Ce,null,{default:s(()=>[l(b,{value:Se.value,"onUpdate:value":i[0]||(i[0]=e=>Se.value=e),placeholder:"è¾“å…¥ç„°åæœç´¢...",onKeyup:f(De,["enter"]),clearable:""},null,8,["value"]),l(m,{type:"primary",onClick:De,loading:ze.value},{default:s(()=>[...i[15]||(i[15]=[r("æœç´¢",-1)])]),_:1},8,["loading"])]),_:1}),xe.value.length?(t(),a("div",X,[(t(!0),a(c,null,o(xe.value,e=>(t(),a("div",{key:e.wallet,class:"friend-card"},[n("div",Y,[n("div",Z,v(e.name),1),n("div",ee,"Lv."+v(e.level)+" Â· "+v(e.realm),1),n("div",ae,"æˆ˜åŠ›: "+v(Re(e.combatPower)),1)]),n("div",le,[e.isFriend?(t(),p(m,{key:0,size:"tiny",disabled:""},{default:s(()=>[...i[16]||(i[16]=[r("å·²æ·»åŠ ",-1)])]),_:1})):(t(),p(m,{key:1,size:"tiny",type:"primary",onClick:a=>async function(e){try{const a=await fetch(_e+"/add",{method:"POST",headers:Ee(),body:JSON.stringify({to_wallet:e})}),l=await a.json();l.ok?(je.success("ç„°å‹ç”³è¯·å·²å‘é€"),De()):je.warning(l.error)}catch{}}(e.wallet),loading:e._adding},{default:s(()=>[...i[17]||(i[17]=[r("æ·»åŠ ",-1)])]),_:1},8,["onClick","loading"]))])]))),128))])):d("",!0)]),_:1}),l(h,{name:"gifts",tab:Ge.value},{default:s(()=>[0===Te.value.length?(t(),a("div",se,"æš‚æ— ç¤¼ç‰©")):d("",!0),n("div",ie,[(t(!0),a(c,null,o(Te.value,e=>(t(),a("div",{key:e.id,class:"friend-card gift-card"},[n("div",te,[n("div",ne,"æ¥è‡ª: "+v(e.fromName),1),n("div",re,v(Xe(e.giftType))+" x"+v(Re(e.giftValue)),1),e.message?(t(),a("div",de,"ğŸ’¬ "+v(e.message),1)):d("",!0)]),n("div",ce,[e.claimed?(t(),p(Ye,{key:1,size:"small",type:"default"},{default:s(()=>[...i[19]||(i[19]=[r("å·²é¢†å–",-1)])]),_:1})):(t(),p(m,{key:0,size:"small",type:"success",onClick:a=>async function(e){try{const a=await fetch(_e+"/gifts/"+e+"/claim",{method:"POST",headers:Ee()}),l=await a.json();l.ok?(je.success(`é¢†å–äº† ${Xe(l.giftType)} x${l.giftValue}`),We()):je.warning(l.error)}catch{}}(e.id)},{default:s(()=>[...i[18]||(i[18]=[r("é¢†å–",-1)])]),_:1},8,["onClick"]))])]))),128))])]),_:1},8,["tab"])]),_:1},8,["value"])]),_:1}),l(la,{show:Le.value,"onUpdate:show":i[3]||(i[3]=e=>Le.value=e),preset:"card",title:"ç„°å‹è¯¦æƒ…",style:{"max-width":"420px"},bordered:!1},{default:s(()=>{return[Je.value?(t(),a("div",oe,[n("div",ue,[i[20]||(i[20]=n("span",{class:"label"},"ç„°å",-1)),n("span",null,v(Je.value.name),1)]),n("div",ve,[i[21]||(i[21]=n("span",{class:"label"},"ç­‰çº§",-1)),n("span",null,"Lv."+v(Je.value.level),1)]),n("div",fe,[i[22]||(i[22]=n("span",{class:"label"},"å¢ƒç•Œ",-1)),n("span",null,v(Je.value.realm),1)]),n("div",pe,[i[23]||(i[23]=n("span",{class:"label"},"æˆ˜åŠ›",-1)),n("span",null,v(Re(Je.value.combatPower)),1)]),n("div",ye,[i[24]||(i[24]=n("span",{class:"label"},"VIP",-1)),n("span",null,v(Je.value.vipLevel>0?"VIP"+Je.value.vipLevel:"æ— "),1)]),Je.value.sect?(t(),a("div",me,[i[25]||(i[25]=n("span",{class:"label"},"ç„°ç›Ÿ",-1)),n("span",null,v(Je.value.sect.name)+"("+v((e=Je.value.sect.role,{leader:"ç›Ÿä¸»",elder:"ç„°é•¿",member:"æˆå‘˜"}[e]||e))+")",1)])):(t(),a("div",ge,[...i[26]||(i[26]=[n("span",{class:"label"},"ç„°ç›Ÿ",-1),n("span",null,"æ— ",-1)])])),l(aa,null,{default:s(()=>[...i[27]||(i[27]=[r("è£…å¤‡",-1)])]),_:1}),Be.value.length?(t(),a("div",he,[(t(!0),a(c,null,o(Be.value,e=>(t(),a("div",{key:e.slot,class:"equip-row"},[n("span",we,v(e.slot),1),n("span",{class:"equip-name",style:y({color:e.color})},v(e.name),5)]))),128))])):(t(),a("div",be,"æœªç©¿æˆ´è£…å¤‡")),l(m,{type:"warning",block:"",style:{"margin-top":"16px"},onClick:i[2]||(i[2]=e=>He(Je.value))},{default:s(()=>[...i[28]||(i[28]=[r("ğŸ é€ç¤¼",-1)])]),_:1})])):d("",!0)];var e}),_:1},8,["show"]),l(la,{show:Ne.value,"onUpdate:show":i[7]||(i[7]=e=>Ne.value=e),preset:"card",title:"ğŸ é€ç¤¼",style:{"max-width":"380px"},bordered:!1},{default:s(()=>[l(na,{"label-placement":"left","label-width":"80"},{default:s(()=>[l(sa,{label:"é€ç»™"},{default:s(()=>{var e;return[r(v((null==(e=Ue.value)?void 0:e.name)||"æœªçŸ¥"),1)]}),_:1}),l(sa,{label:"ç±»å‹"},{default:s(()=>[l(ia,{value:$e.value.gift_type,"onUpdate:value":i[4]||(i[4]=e=>$e.value.gift_type=e),options:Ve},null,8,["value"])]),_:1}),l(sa,{label:"æ•°é‡"},{default:s(()=>[l(ta,{value:$e.value.gift_value,"onUpdate:value":i[5]||(i[5]=e=>$e.value.gift_value=e),min:1,max:1e5,style:{width:"100%"}},null,8,["value"])]),_:1}),l(sa,{label:"ç•™è¨€"},{default:s(()=>[l(b,{value:$e.value.message,"onUpdate:value":i[6]||(i[6]=e=>$e.value.message=e),placeholder:"å†™ç‚¹ä»€ä¹ˆ...",maxlength:"50"},null,8,["value"])]),_:1}),n("div",ke,"ä»Šæ—¥å‰©ä½™é€ç¤¼æ¬¡æ•°: "+v(Ie.value)+"/3",1),l(m,{type:"warning",block:"",onClick:Qe,loading:Fe.value,disabled:Ie.value<=0},{default:s(()=>[...i[29]||(i[29]=[r("ç¡®è®¤é€å‡º",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["show"])])}}},[["__scopeId","data-v-66612f89"]]);export{je as default};
