import{_ as e,a}from"./index-DkhJWZ0D.js";import{c as t,j as l,q as n,D as s,E as u,R as i,k as r,B as d,Y as o,L as c,M as v,J as p,w as y,O as _,a0 as f,V as m,t as w}from"./naive-ui-CtewNtT3.js";import{o as h,bg as g,bF as b,bE as k,r as x,bf as T,bh as U,b1 as V,k as z,bi as j,E as C}from"./vendor-CBGg7cPT.js";const D={class:"admin-events"},$={style:{"margin-left":"8px",color:"#a09880"}},S="/api",E=e({__name:"AdminEvents",setup(e){const E=a(),{message:q,dialog:P}=t(["message","dialog"]),B=()=>({"Content-Type":"application/json",Authorization:`Bearer ${E.token}`}),O=x([]),I=x(!1),L=x({activeEvents:0,totalClaims:0,totalPlayers:0}),A=x(!1),J=x(null),N=x(!1),R=x(null),F=x(!1),M=x([]),Y=x(!1),G=[{label:"åŒå€å†¥æƒ³",value:"double_cultivation"},{label:"æŠ½å¡æ¦‚ç‡UP",value:"gacha_rate_up"},{label:"åŒå€æ‰è½",value:"double_drop"},{label:"ç„°æ™¶å•†é“ºæŠ˜æ‰£",value:"discount"},{label:"ç™»å½•å¥–åŠ±",value:"login_bonus"}],H=[{label:"ç„°æ™¶",value:"spirit_stones"},{label:"é“å…·",value:"items"}],K={double_cultivation:"åŒå€å†¥æƒ³",gacha_rate_up:"æ¦‚ç‡UP",double_drop:"åŒå€æ‰è½",discount:"ç„°æ™¶å•†é“ºæŠ˜æ‰£",login_bonus:"ç™»å½•å¥–åŠ±"},Q=x({name:"",description:"",type:null,effectValue:2,rewardType:"spirit_stones",rewardValue:1e3,starts_at:null,ends_at:null,active:!0}),W={name:{required:!0,message:"è¯·è¾“å…¥åç§°",trigger:"blur"},type:{required:!0,message:"è¯·é€‰æ‹©ç±»å‹",trigger:"change"},starts_at:{type:"number",required:!0,message:"è¯·é€‰æ‹©å¼€å§‹æ—¶é—´",trigger:"change"},ends_at:{type:"number",required:!0,message:"è¯·é€‰æ‹©ç»“æŸæ—¶é—´",trigger:"change"}};function X(e){const a=Date.now(),t=new Date(e.starts_at).getTime(),l=new Date(e.ends_at).getTime();return e.active?a<t?{text:"æœªå¼€å§‹",type:"info"}:a>l?{text:"å·²ç»“æŸ",type:"default"}:{text:"è¿›è¡Œä¸­",type:"success"}:{text:"å·²ç¦ç”¨",type:"default"}}function Z(e){return"å·²ç»“æŸ"===X(e).text?"row-ended":""}function ee(e){return e?new Date(e).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}const ae=[{title:"ID",key:"id",width:50},{title:"åç§°",key:"name",width:140},{title:"ç±»å‹",key:"type",width:100,render:e=>C(w,{size:"small",type:"warning",bordered:!1},()=>K[e.type]||e.type)},{title:"æ•ˆæœ",key:"config",width:80,render:e=>{const a=e.config||{};return a.multiplier||a.rateBoost||a.discount||a.dailyStones||"-"}},{title:"å¼€å§‹",key:"starts_at",width:110,render:e=>ee(e.starts_at)},{title:"ç»“æŸ",key:"ends_at",width:110,render:e=>ee(e.ends_at)},{title:"çŠ¶æ€",key:"status",width:80,render:e=>{const a=X(e);return C(w,{size:"small",type:a.type,bordered:!1},()=>a.text)}},{title:"æ“ä½œ",key:"actions",width:200,render:e=>C(r,{size:4},()=>[C(d,{size:"tiny",type:"info",quaternary:!0,onClick:()=>async function(e){F.value=!0,Y.value=!0;try{const a=await fetch(`${S}/admin/events/${e}/claims`,{headers:B()}),t=await a.json();M.value=t.claims||[]}catch{q.error("åŠ è½½å¤±è´¥")}Y.value=!1}(e.id)},()=>"é¢†å–è®°å½•"),C(d,{size:"tiny",type:"warning",quaternary:!0,onClick:()=>function(e){J.value=e.id;const a=e.config||{},t=a.multiplier||a.rateBoost||a.discount||a.dailyStones||0,l=(e.rewards||[])[0]||{};Q.value={name:e.name,description:e.description||"",type:e.type,effectValue:t,rewardType:l.type||"spirit_stones",rewardValue:l.value||0,starts_at:new Date(e.starts_at).getTime(),ends_at:new Date(e.ends_at).getTime(),active:e.active},A.value=!0}(e)},()=>"ç¼–è¾‘"),C(d,{size:"tiny",type:"error",quaternary:!0,onClick:()=>{return a=e,void P.warning({title:"ç¡®è®¤åˆ é™¤",content:`ç¡®å®šåˆ é™¤æ´»åŠ¨ã€Œ${a.name}ã€ï¼Ÿç›¸å…³é¢†å–è®°å½•ä¹Ÿä¼šè¢«åˆ é™¤ã€‚`,positiveText:"åˆ é™¤",negativeText:"å–æ¶ˆ",onPositiveClick:async()=>{try{await fetch(`${S}/admin/events/${a.id}`,{method:"DELETE",headers:B()}),q.success("å·²åˆ é™¤"),le(),ne()}catch{q.error("åˆ é™¤å¤±è´¥")}}});var a}},()=>"åˆ é™¤")])}],te=[{title:"ç©å®¶",key:"name",width:120,render:e=>e.name||"æ— åç„°ä¿®"},{title:"é’±åŒ…",key:"wallet",width:140,render:e=>e.wallet?e.wallet.slice(0,6)+"..."+e.wallet.slice(-4):"-"},{title:"é¢†å–æ—¶é—´",key:"claimed_at",render:e=>ee(e.claimed_at)}];async function le(){I.value=!0;try{const e=await fetch(`${S}/admin/events`,{headers:B()}),a=await e.json();O.value=a.events||[]}catch(e){q.error("åŠ è½½å¤±è´¥")}I.value=!1}async function ne(){try{const e=await fetch(`${S}/admin/stats`,{headers:B()});L.value=await e.json()}catch{}}function se(){J.value=null,Q.value={name:"",description:"",type:null,effectValue:2,rewardType:"spirit_stones",rewardValue:1e3,starts_at:null,ends_at:null,active:!0},A.value=!0}async function ue(){var e;try{await(null==(e=R.value)?void 0:e.validate())}catch{return}N.value=!0;try{const e=function(){const e=Q.value,a={};return a[{double_cultivation:"multiplier",gacha_rate_up:"rateBoost",double_drop:"multiplier",discount:"discount",login_bonus:"dailyStones"}[e.type]||"multiplier"]=e.effectValue,{name:e.name,description:e.description,type:e.type,config:a,rewards:[{type:e.rewardType,value:e.rewardValue}],starts_at:new Date(e.starts_at).toISOString(),ends_at:new Date(e.ends_at).toISOString(),active:e.active}}(),a=J.value?`${S}/admin/events/${J.value}`:`${S}/admin/events`,t=J.value?"PUT":"POST",l=await fetch(a,{method:t,headers:B(),body:JSON.stringify(e)}),n=await l.json();if(n.error)return void q.error(n.error);q.success(J.value?"å·²æ›´æ–°":"å·²åˆ›å»º"),A.value=!1,le(),ne()}catch(a){q.error("æ“ä½œå¤±è´¥")}N.value=!1}return h(()=>{le(),ne()}),(e,a)=>{const t=i,w=l,h=u,x=s,C=o,S=p,E=v,q=y,P=_,B=f,K=m,X=c,ee=n;return T(),g("div",D,[b(w,{bordered:!1},{default:k(()=>[b(x,{cols:3,"x-gap":12,"y-gap":12,style:{"margin-bottom":"20px"}},{default:k(()=>[b(h,null,{default:k(()=>[b(w,{size:"small",class:"stat-card"},{default:k(()=>[b(t,{label:"æ´»è·ƒæ´»åŠ¨",value:L.value.activeEvents},{prefix:k(()=>[...a[12]||(a[12]=[U("span",{style:{color:"#4caf50"}},"ğŸŸ¢",-1)])]),_:1},8,["value"])]),_:1})]),_:1}),b(h,null,{default:k(()=>[b(w,{size:"small",class:"stat-card"},{default:k(()=>[b(t,{label:"æ€»é¢†å–æ¬¡æ•°",value:L.value.totalClaims},{prefix:k(()=>[...a[13]||(a[13]=[U("span",null,"ğŸ",-1)])]),_:1},8,["value"])]),_:1})]),_:1}),b(h,null,{default:k(()=>[b(w,{size:"small",class:"stat-card"},{default:k(()=>[b(t,{label:"æ€»ç©å®¶æ•°",value:L.value.totalPlayers},{prefix:k(()=>[...a[14]||(a[14]=[U("span",null,"ğŸ‘¥",-1)])]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),b(V(r),{justify:"end",style:{"margin-bottom":"12px"}},{default:k(()=>[b(V(d),{type:"primary",onClick:se},{default:k(()=>[...a[15]||(a[15]=[z("âœ¨ åˆ›å»ºæ´»åŠ¨",-1)])]),_:1})]),_:1}),b(C,{columns:ae,data:O.value,loading:I.value,"row-key":e=>e.id,"row-class-name":Z},null,8,["data","loading","row-key"])]),_:1}),b(ee,{show:A.value,"onUpdate:show":a[10]||(a[10]=e=>A.value=e),preset:"card",title:J.value?"ç¼–è¾‘æ´»åŠ¨":"åˆ›å»ºæ´»åŠ¨",style:{width:"600px","max-width":"95vw"},"mask-closable":!1},{footer:k(()=>[b(V(r),{justify:"end"},{default:k(()=>[b(V(d),{onClick:a[9]||(a[9]=e=>A.value=!1)},{default:k(()=>[...a[16]||(a[16]=[z("å–æ¶ˆ",-1)])]),_:1}),b(V(d),{type:"primary",onClick:ue,loading:N.value},{default:k(()=>[z(j(J.value?"ä¿å­˜":"åˆ›å»º"),1)]),_:1},8,["loading"])]),_:1})]),default:k(()=>[b(X,{ref_key:"formRef",ref:R,model:Q.value,rules:W,"label-placement":"left","label-width":"80"},{default:k(()=>[b(E,{label:"åç§°",path:"name"},{default:k(()=>[b(S,{value:Q.value.name,"onUpdate:value":a[0]||(a[0]=e=>Q.value.name=e),placeholder:"æ´»åŠ¨åç§°"},null,8,["value"])]),_:1}),b(E,{label:"æè¿°",path:"description"},{default:k(()=>[b(S,{value:Q.value.description,"onUpdate:value":a[1]||(a[1]=e=>Q.value.description=e),type:"textarea",placeholder:"æ´»åŠ¨æè¿°",rows:2},null,8,["value"])]),_:1}),b(E,{label:"ç±»å‹",path:"type"},{default:k(()=>[b(q,{value:Q.value.type,"onUpdate:value":a[2]||(a[2]=e=>Q.value.type=e),options:G,placeholder:"é€‰æ‹©æ´»åŠ¨ç±»å‹"},null,8,["value"])]),_:1}),b(E,{label:"æ•ˆæœå€¼"},{default:k(()=>[b(P,{value:Q.value.effectValue,"onUpdate:value":a[3]||(a[3]=e=>Q.value.effectValue=e),min:0,step:.1,placeholder:"å¦‚å€ç‡2, æŠ˜æ‰£0.8",style:{width:"100%"}},null,8,["value"])]),_:1}),b(x,{cols:2,"x-gap":12},{default:k(()=>[b(h,null,{default:k(()=>[b(E,{label:"å¥–åŠ±ç±»å‹"},{default:k(()=>[b(q,{value:Q.value.rewardType,"onUpdate:value":a[4]||(a[4]=e=>Q.value.rewardType=e),options:H,placeholder:"å¥–åŠ±ç±»å‹"},null,8,["value"])]),_:1})]),_:1}),b(h,null,{default:k(()=>[b(E,{label:"å¥–åŠ±å€¼"},{default:k(()=>[b(P,{value:Q.value.rewardValue,"onUpdate:value":a[5]||(a[5]=e=>Q.value.rewardValue=e),min:0,placeholder:"å¥–åŠ±æ•°é‡",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),b(x,{cols:2,"x-gap":12},{default:k(()=>[b(h,null,{default:k(()=>[b(E,{label:"å¼€å§‹æ—¶é—´",path:"starts_at"},{default:k(()=>[b(B,{value:Q.value.starts_at,"onUpdate:value":a[6]||(a[6]=e=>Q.value.starts_at=e),type:"datetime",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),b(h,null,{default:k(()=>[b(E,{label:"ç»“æŸæ—¶é—´",path:"ends_at"},{default:k(()=>[b(B,{value:Q.value.ends_at,"onUpdate:value":a[7]||(a[7]=e=>Q.value.ends_at=e),type:"datetime",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),b(E,{label:"çŠ¶æ€"},{default:k(()=>[b(K,{value:Q.value.active,"onUpdate:value":a[8]||(a[8]=e=>Q.value.active=e)},null,8,["value"]),U("span",$,j(Q.value.active?"å¯ç”¨":"ç¦ç”¨"),1)]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),b(ee,{show:F.value,"onUpdate:show":a[11]||(a[11]=e=>F.value=e),preset:"card",title:"é¢†å–è®°å½•",style:{width:"550px","max-width":"95vw"}},{default:k(()=>[b(C,{columns:te,data:M.value,loading:Y.value,size:"small"},null,8,["data","loading"])]),_:1},8,["show"])])}}},[["__scopeId","data-v-85117467"]]);export{E as default};
