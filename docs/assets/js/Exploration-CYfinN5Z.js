import{aC as e,bg as a,bF as t,bE as n,bh as i,bi as s,b1 as l,F as o,bk as r,T as c,r as u,q as p,bf as v,k as m,aW as d,b7 as f,bj as h}from"./vendor-CBGg7cPT.js";import{p as y,a as g,_,u as b,b as $}from"./index-DkhJWZ0D.js";import{g as k,h as w}from"./herbs-Cu1BpqBJ.js";import{L as x}from"./LogPanel-ComOJV2M.js";import{G as C}from"./GameGuide-Sg6BGPLx.js";import{j as L,k as M,t as j,B as z}from"./naive-ui-CtewNtT3.js";const I=[{id:"newbie_village",name:"è–ªç«æ‘",description:"ç„°æ°”åˆç”Ÿä¹‹åœ°ï¼Œé€‚åˆåˆå…¥ä¿®ç„°ä¹‹é“çš„ç„°ä¿®ã€‚",minLevel:1,spiritCost:50,rewards:[{type:"spirit_stone",chance:.3,amount:[1,3]},{type:"herb",chance:.3,amount:[1,2]},{type:"cultivation",chance:.2,amount:[5,10]},{type:"pill_fragment",chance:.2,amount:[1,1]}]},{id:"celestial_mountain",name:"èµ¤éœ„å³°",description:"èµ¤ç„°ç¼­ç»•çš„ç„°å±±ï¼Œä¼ è¯´æ˜¯è¿œå¤ç„°ä»™è®²é“ä¹‹åœ°ã€‚",minLevel:10,spiritCost:1500,rewards:[{type:"spirit_stone",chance:.25,amount:[30,60]},{type:"herb",chance:.3,amount:[15,25]},{type:"cultivation",chance:.25,amount:[150,300]},{type:"pill_fragment",chance:.2,amount:[6,10]}]},{id:"phoenix_valley",name:"æ¶…æ§ƒè°·",description:"å¸¸å¹´è¢«çƒˆç„°ç¯ç»•çš„ç¥ç§˜å±±è°·ï¼Œæ®è¯´æœ‰å‡¤å‡°æ¶…æ§ƒé—ç•™çš„ç„°éŸµã€‚",minLevel:19,spiritCost:2e3,rewards:[{type:"spirit_stone",chance:.25,amount:[50,100]},{type:"herb",chance:.3,amount:[20,35]},{type:"cultivation",chance:.25,amount:[250,500]},{type:"pill_fragment",chance:.2,amount:[8,12]}]},{id:"dragon_abyss",name:"ç„°æ¸Š",description:"æ·±ä¸è§åº•çš„ç¥ç§˜æ·±æ¸Šï¼Œè•´å«è¿œå¤ç„°é¾™çš„æ°”æ¯ã€‚",minLevel:28,spiritCost:3e3,rewards:[{type:"spirit_stone",chance:.25,amount:[80,150]},{type:"herb",chance:.3,amount:[30,50]},{type:"cultivation",chance:.25,amount:[400,800]},{type:"pill_fragment",chance:.2,amount:[10,15]}]},{id:"immortal_realm",name:"ç„°å¤©åœ£åŸŸå…¥å£",description:"ç„°æ°”æœ€ä¸ºæµ“éƒçš„è‡³é«˜åœ£åŸŸï¼Œå”¯æœ‰åŒ–ç„°æœŸä»¥ä¸Šçš„ç„°ä¿®æ–¹å¯è¸å…¥ã€‚",minLevel:37,spiritCost:5e3,rewards:[{type:"spirit_stone",chance:.25,amount:[150,300]},{type:"herb",chance:.3,amount:[50,100]},{type:"cultivation",chance:.25,amount:[800,1500]},{type:"pill_fragment",chance:.2,amount:[15,20]}]}];async function S(e){try{const a=g();if(!a.isLoggedIn)return;await fetch("/api/exploration/reward",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a.token},body:JSON.stringify(e)})}catch(a){console.warn("æ¢ç´¢å¥–åŠ±åŒæ­¥å¤±è´¥:",a.message)}}const F=[{id:"ancient_tablet",name:"å¤è€çŸ³ç¢‘",description:"å‘ç°ä¸€å—åˆ»æœ‰ä¸Šå¤åŠŸæ³•çš„çŸ³ç¢‘ã€‚",chance:.08,effect:(e,a)=>{const t=Math.floor(30*(e.level/5+1));e.cultivation+=t,a("success",`[å¤è€çŸ³ç¢‘]é¢†æ‚ŸçŸ³ç¢‘ä¸Šçš„åŠŸæ³•ï¼Œè·å¾—${t}ç‚¹ä¿®ä¸º`)}},{id:"spirit_spring",name:"çµæ³‰",description:"å¶é‡ä¸€å¤„å¤©ç„¶çµæ³‰ã€‚",chance:.12,effect:(e,a)=>{const t=Math.floor(60*(e.level/3+1));e.spirit+=t,a("success",`[çµæ³‰]é¥®ç”¨çµæ³‰ï¼Œç„°çµå¢åŠ ${t}ç‚¹`)}},{id:"ancient_master",name:"å¤ä¿®é—åºœ",description:"æ„å¤–å‘ç°ä¸€ä½ä¸Šå¤å¤§èƒ½çš„æ´åºœã€‚",chance:.03,effect:(e,a)=>{const t=Math.floor(120*(e.level/2+1)),n=Math.floor(180*(e.level/2+1));e.cultivation+=t,e.spirit+=n,a("success",`[å¤ä¿®é—åºœ]è·å¾—ä¸Šå¤å¤§èƒ½ä¼ æ‰¿ï¼Œä¿®ä¸ºå¢åŠ ${t}ç‚¹ï¼Œç„°çµå¢åŠ ${n}ç‚¹`)}},{id:"monster_attack",name:"é»‘ç„°å…½è¢­å‡»",description:"é­é‡ä¸€åªå®åŠ›å¼ºå¤§çš„é»‘ç„°å…½ã€‚",chance:.15,effect:(e,a)=>{const t=Math.floor(80*(e.level/4+1));e.spirit=Math.max(0,e.spirit-t),a("error",`[é»‘ç„°å…½è¢­å‡»]ä¸é»‘ç„°å…½æ¿€æˆ˜ï¼ŒæŸå¤±${t}ç‚¹ç„°çµ`)}},{id:"cultivation_deviation",name:"èµ°ç«å…¥é­”",description:"ä¿®ç‚¼å‡ºç°åå·®ï¼Œèµ°ç«å…¥é­”ã€‚",chance:.12,effect:(e,a)=>{const t=Math.floor(50*(e.level/3+1));e.cultivation=Math.max(0,e.cultivation-t),a("error",`[èµ°ç«å…¥é­”]èµ°ç«å…¥é­”ï¼ŒæŸå¤±${t}ç‚¹ä¿®ä¸º`)}},{id:"treasure_trove",name:"ç„°åŸŸå®è—",description:"å‘ç°ä¸€å¤„ä¸Šå¤ä¿®å£«é—ç•™çš„å®è—ã€‚",chance:.05,effect:(e,a)=>{const t=Math.floor(30*(e.level/2+1));e.spiritStones+=t,a("success",`[ç„°åŸŸå®è—]å‘ç°å®è—ï¼Œè·å¾—${t}é¢—ç„°æ™¶`)}},{id:"enlightenment",name:"é¡¿æ‚Ÿ",description:"ä¿®ç‚¼ä¸­çªç„¶é¡¿æ‚Ÿã€‚",chance:.08,effect:(e,a)=>{const t=Math.floor(50*(e.level/4+1));e.cultivation+=t,e.spiritRate*=1.05,a("success",`[é¡¿æ‚Ÿ]çªç„¶é¡¿æ‚Ÿï¼Œè·å¾—${t}ç‚¹ä¿®ä¸ºï¼Œç„°çµè·å–é€Ÿç‡æå‡5%`)}},{id:"qi_deviation",name:"å¿ƒé­”ä¾µæ‰°",description:"é­å—å¿ƒé­”ä¾µæ‰°ï¼Œä¿®ä¸ºå—æŸã€‚",chance:.15,effect:(e,a)=>{const t=Math.floor(60*(e.level/3+1));e.spirit=Math.max(0,e.spirit-t),e.cultivation=Math.max(0,e.cultivation-t),a("error",`[å¿ƒé­”ä¾µæ‰°]é­å—å¿ƒé­”ä¾µæ‰°ï¼ŒæŸå¤±${t}ç‚¹ç„°çµå’Œä¿®ä¸º`)}}],O={class:"explore-page"},T={class:"world-map"},q={class:"map-title"},B={class:"map-spirit"},D={class:"map-grid"},A=["onClick"],P={class:"node-content"},E={class:"node-icon"},G={class:"node-name"},J={key:0,class:"node-lock"},N={key:1,class:"node-status exploring-pulse"},R={key:2,class:"node-cost"},W={key:0,class:"location-detail"},H={class:"detail-header"},K={class:"detail-icon"},Q={class:"detail-info"},U={class:"detail-name"},V={class:"detail-desc"},X={class:"explore-stats"},Y=_({__name:"Exploration",setup(_){const Y=u(null),Z=b(),ee=g(),ae=u(null),te=u(!1),ne={newbie_village:"ğŸ˜ï¸",celestial_mountain:"â›°ï¸",phoenix_valley:"ğŸ”¥",dragon_abyss:"ğŸ‰",immortal_realm:"âœ¨"},ie={newbie_village:"/assets/images/area-xinhuocun.png",celestial_mountain:"/assets/images/area-chixiaofeng.png",phoenix_valley:"/assets/images/area-niepangu.png",dragon_abyss:"/assets/images/area-yanyuan.png",immortal_realm:"/assets/images/area-yantianshenyu.png"},se=p(()=>I.map(e=>({...e,icon:ne[e.id]||"ğŸ—ºï¸"}))),le=u({}),oe=u({}),re=u(!1),ce=(e,a)=>{var t;return null==(t=Y.value)?void 0:t.addLog(e,a)},ue=async e=>{var a,t;if(!te.value)if(Z.stopAutoCultivation(),Z.spirit<e.spiritCost)ce("error","ç„°çµä¸è¶³ï¼");else{if(te.value=!0,!ee.isLoggedIn)return pe(e),void(te.value=!1);try{const t=await fetch("/api/exploration/explore",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+ee.token},body:JSON.stringify({locationId:e.id})}),n=await t.json();if(!t.ok)return ce("error",n.error||"æ¢ç´¢å¤±è´¥"),re.value&&(null==(a=ae.value)?void 0:a.id)===e.id&&me(e),void(te.value=!1);if(n.success){if(Z.spirit=n.spirit,Z.spiritStones=n.spiritStones,Z.cultivation=n.cultivation,Z.explorationCount++,n.event&&(ce("info",`[${n.event.name}]${n.event.description}`),n.event.effect)){const e=n.event.effect;"cultivation"===e.type?ce("success",`[${n.event.name}]é¢†æ‚ŸçŸ³ç¢‘ä¸Šçš„åŠŸæ³•ï¼Œè·å¾—${e.amount}ç‚¹ä¿®ä¸º`):"spirit"===e.type?ce("success",`[${n.event.name}]é¥®ç”¨çµæ³‰ï¼Œç„°çµå¢åŠ ${e.amount}ç‚¹`):"double"===e.type?ce("success",`[${n.event.name}]è·å¾—ä¸Šå¤å¤§èƒ½ä¼ æ‰¿ï¼Œä¿®ä¸ºå¢åŠ ${e.cultivation}ç‚¹ï¼Œç„°çµå¢åŠ ${e.spirit}ç‚¹`):"stones"===e.type?ce("success",`[${n.event.name}]å‘ç°å®è—ï¼Œè·å¾—${e.amount}é¢—ç„°æ™¶`):"enlightenment"===e.type?ce("success",`[${n.event.name}]çªç„¶é¡¿æ‚Ÿï¼Œè·å¾—${e.cultivation}ç‚¹ä¿®ä¸ºï¼Œç„°çµè·å–é€Ÿç‡æå‡5%`):"damage"===e.type&&(e.spirit&&e.cultivation?ce("error",`[${n.event.name}]é­å—å¿ƒé­”ä¾µæ‰°ï¼ŒæŸå¤±${e.spirit}ç‚¹ç„°çµå’Œä¿®ä¸º`):e.spirit?ce("error",`[${n.event.name}]ä¸é»‘ç„°å…½æ¿€æˆ˜ï¼ŒæŸå¤±${e.spirit}ç‚¹ç„°çµ`):e.cultivation&&ce("error",`[${n.event.name}]èµ°ç«å…¥é­”ï¼ŒæŸå¤±${e.cultivation}ç‚¹ä¿®ä¸º`))}if(n.reward){const e=n.reward;"spirit_stone"===e.type?ce("success",`[ç„°æ™¶è·å–]è·å¾—${e.amount}é¢—ç„°æ™¶`):"herb"===e.type?(ce("success",`[ç„°è‰è·å–]è·å¾—${e.amount}ä¸ªç„°è‰`),await ve()):"cultivation"===e.type?ce("success",`[ä¿®ä¸ºè·å–]è·å¾—${e.amount}ç‚¹ä¿®ä¸º`):"pill_fragment"===e.type&&(ce("success",`[ä¸¹æ–¹è·å–]è·å¾—${e.amount}ä¸ªä¸¹æ–¹æ®‹é¡µ`),await ve())}Z.saveData()}}catch(n){ce("error","æ¢ç´¢å¤±è´¥ï¼š"+n.message),re.value&&(null==(t=ae.value)?void 0:t.id)===e.id&&me(e)}finally{te.value=!1}}},pe=e=>{if(Z.spirit-=e.spiritCost,Z.explorationCount++,((e,a)=>{for(const t of F)if(Math.random()<=t.chance)return a("info",`[${t.name}]${t.description}`),t.effect(e,a),e.eventTriggered++,e.saveData(),!0;return!1})(Z,ce))ce("info","ä½ çš„ç¦ç¼˜ä¸é”™ï¼Œè§¦å‘äº†ä¸€ä¸ªç‰¹æ®Šäº‹ä»¶ï¼");else{const a=(e=>{const a=Math.random();let t=0;for(const n of e)if(t+=n.chance,a<=t){const e=Math.floor(Math.random()*(n.amount[1]-n.amount[0]+1))+n.amount[0];return{type:n.type,amount:e}}return null})(e.rewards);a&&((e,a,t)=>{switch(e.type){case"spirit_stone":a.spiritStones+=e.amount,t("success",`[ç„°æ™¶è·å–]è·å¾—${e.amount}é¢—ç„°æ™¶`),S({type:"spirit_stone",amount:e.amount});break;case"herb":for(let n=0;n<e.amount;n++){const e=k();e&&(a.herbs.push(e),t("success",`[ç„°è‰è·å–]è·å¾—${w[e.quality].name}å“è´¨çš„${e.name}`),S({type:"herb",amount:1,herbId:e.id,name:e.name,quality:e.quality,value:e.value||0}))}break;case"cultivation":a.cultivate(e.amount),t("success",`[ä¿®ä¸ºè·å–]è·å¾—${e.amount}ç‚¹ä¿®ä¸º`),a.cultivation>=a.maxCultivation&&a.tryBreakthrough()&&t("success",`[çªç ´]çªç ´æˆåŠŸï¼å½“å‰å¢ƒç•Œï¼š${a.realm}`);break;case"pill_fragment":for(let n=0;n<e.amount;n++){const e=y[Math.floor(Math.random()*y.length)];e&&(a.gainPillFragment(e.id),t("success",`[ä¸¹æ–¹è·å–]è·å¾—${e.name}çš„ä¸¹æ–¹æ®‹é¡µ`))}}})(a,Z,ce)}Z.saveData()},ve=async()=>{var e;if(ee.isLoggedIn)try{const a=await fetch("/api/game/load",{headers:{Authorization:"Bearer "+ee.token}});if(a.ok){const t=await a.json();if(null==(e=t.player)?void 0:e.gameData){const e=t.player.gameData;e.herbs&&(Z.herbs=e.herbs),e.pillFragments&&(Z.pillFragments=e.pillFragments)}}}catch(a){console.warn("åˆ·æ–°æ•°æ®å¤±è´¥:",a)}},me=e=>{oe.value[e.id]&&(clearInterval(oe.value[e.id]),delete oe.value[e.id]),le.value[e.id]=!1,re.value=!1};e(()=>{Object.values(oe.value).forEach(e=>clearInterval(e)),oe.value={},le.value={}});const de=()=>{var e;null==(e=Y.value)||e.clearLogs()};return(e,u)=>{const p=j,y=M,g=z,_=L;return v(),a("div",O,[t(C,null,{default:n(()=>[...u[2]||(u[2]=[i("p",null,[m("ğŸ—ºï¸ æ¢ç´¢ä¸åŒåœ°ç‚¹ï¼Œè·å¾—"),i("strong",null,"ç„°è‰ã€ç„°æ™¶ã€ç„°åŠ›ã€ä¸¹æ–¹æ®‹é¡µ")],-1),i("p",null,"ğŸ“ 5ä¸ªåœ°ç‚¹ï¼šè–ªç«æ‘(1çº§)â†’èµ¤éœ„å³°(10çº§)â†’æ¶…æ§ƒè°·(19çº§)â†’ç„°æ¸Š(28çº§)â†’ç„°å¤©åœ£åŸŸ(37çº§)",-1),i("p",null,[m("ğŸ€ "),i("strong",null,"å¹¸è¿å€¼"),m("å½±å“ç„°è‰å“è´¨å’Œæ¢ç´¢å¥–åŠ±")],-1),i("p",null,"âš¡ æ¢ç´¢æ¶ˆè€—ç„°çµï¼Œé«˜çº§åœ°ç‚¹æ¶ˆè€—æ›´å¤šä½†å¥–åŠ±æ›´ä¸°åš",-1),i("p",null,"ğŸ² å¯èƒ½è§¦å‘éšæœºäº‹ä»¶ï¼šå¤ä¿®é—åºœ(å¤§é‡å¥–åŠ±)ã€é¡¿æ‚Ÿã€çµæ³‰ç­‰",-1),i("p",null,[m("ğŸ¤– å¼€å¯"),i("strong",null,"è‡ªåŠ¨æ¢ç´¢"),m("æ¯3ç§’æ¢ç´¢ä¸€æ¬¡ï¼Œç„°çµä¸è¶³è‡ªåŠ¨åœæ­¢")],-1)])]),_:1}),i("div",T,[i("div",q,[u[3]||(u[3]=i("span",{class:"map-icon"},"ğŸ—ºï¸",-1)),u[4]||(u[4]=i("span",null,"ç„°å¤©åœ£åŸŸåœ°å›¾",-1)),i("span",B,"ç„°çµ: "+s(l(Z).spirit.toFixed(0)),1)]),i("div",D,[(v(!0),a(o,null,r(se.value,e=>{var t;return v(),a("div",{key:e.id,class:d(["map-node",{locked:l(Z).level<e.minLevel,active:(null==(t=ae.value)?void 0:t.id)===e.id,exploring:le.value[e.id]}]),onClick:a=>(e=>{Z.level>=e.minLevel&&(ae.value=e)})(e)},[i("div",{class:d(["node-bg","bg-"+e.id]),style:f(ie[e.id]?{background:`linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.7)), url(${ie[e.id]}) center/cover no-repeat`}:{})},null,6),i("div",P,[i("span",E,s(e.icon),1),i("span",G,s(e.name),1),l(Z).level<e.minLevel?(v(),a("span",J,"ğŸ”’ "+s(l($)(e.minLevel).name),1)):le.value[e.id]?(v(),a("span",N,"æ¢ç´¢ä¸­...")):(v(),a("span",R,"âš¡"+s(e.spiritCost),1))])],10,A)}),128))])]),t(c,{name:"slide"},{default:n(()=>[ae.value?(v(),a("div",W,[t(_,{size:"small"},{default:n(()=>[i("div",H,[i("span",K,s(ae.value.icon),1),i("div",Q,[i("span",U,s(ae.value.name),1),i("span",V,s(ae.value.description),1)])]),t(y,{size:8,style:{"margin-top":"12px"}},{default:n(()=>[t(p,{type:"info",size:"small"},{default:n(()=>[m("ç„°çµæ¶ˆè€—: "+s(ae.value.spiritCost),1)]),_:1}),t(p,{type:"warning",size:"small"},{default:n(()=>[m("æœ€ä½ç„°é˜¶: "+s(l($)(ae.value.minLevel).name),1)]),_:1})]),_:1}),t(y,{style:{"margin-top":"12px"},size:8},{default:n(()=>[t(g,{type:"primary",onClick:u[0]||(u[0]=e=>ue(ae.value)),disabled:l(Z).spirit<ae.value.spiritCost||re.value||l(Z).level<ae.value.minLevel||te.value,loading:te.value},{default:n(()=>[...u[5]||(u[5]=[m(" ğŸ” æ¢ç´¢ä¸€æ¬¡ ",-1)])]),_:1},8,["disabled","loading"]),t(g,{type:le.value[ae.value.id]?"warning":"success",onClick:u[1]||(u[1]=e=>{return le.value[ae.value.id]?me(ae.value):(a=ae.value,void(le.value[a.id]||re.value||(re.value=!0,le.value[a.id]=!0,oe.value[a.id]=setInterval(()=>{Z.spirit>=a.spiritCost?ue(a):(me(a),ce("warning","ç„°çµä¸è¶³ï¼Œè‡ªåŠ¨æ¢ç´¢å·²åœæ­¢ï¼"))},3e3))));var a}),disabled:l(Z).spirit<ae.value.spiritCost||re.value&&!le.value[ae.value.id]||l(Z).level<ae.value.minLevel||te.value},{default:n(()=>[m(s(le.value[ae.value.id]?"â¹ åœæ­¢":"ğŸ”„ è‡ªåŠ¨æ¢ç´¢"),1)]),_:1},8,["type","disabled"])]),_:1})]),_:1})])):h("",!0)]),_:1}),i("div",X,[t(_,{size:"small",title:"ğŸ“Š æ¢ç´¢ç»Ÿè®¡"},{default:n(()=>[t(y,{size:16},{default:n(()=>[i("span",null,"æ¢ç´¢ "+s(l(Z).explorationCount)+" æ¬¡",1),i("span",null,"ç„°æ™¶ "+s(l(Z).spiritStones),1),i("span",null,"ç„°è‰ "+s(l(Z).herbs.length),1),i("span",null,"ç„°æ–¹æ®‹é¡µ "+s(Object.values(l(Z).pillFragments||{}).reduce((e,a)=>e+a,0)),1)]),_:1})]),_:1})]),t(y,{justify:"end",style:{"margin-bottom":"8px"}},{default:n(()=>[t(g,{size:"small",onClick:de,type:"error",secondary:""},{default:n(()=>[...u[6]||(u[6]=[m("æ¸…ç©ºæ—¥å¿—",-1)])]),_:1})]),_:1}),t(x,{ref_key:"logRef",ref:Y,title:"æ¢ç´¢æ—¥å¿—"},null,512)])}}},[["__scopeId","data-v-de633c22"]]);export{Y as default};
