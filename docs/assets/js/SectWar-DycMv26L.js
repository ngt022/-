import{_ as e,u as a,a as s}from"./index-C_Usn6qf.js";import{G as l}from"./GameGuide-Dc_uhL03.js";import{c as t,p as n,q as r,s as i,j as d,B as c,t as o,J as u}from"./naive-ui-CtewNtT3.js";import{o as v,bg as p,bF as h,bE as w,r as f,bf as g,bh as m,k as y,bi as _,bn as k,bj as b,F as j,bk as S,aW as C,b7 as $,q as O}from"./vendor-CBGg7cPT.js";const x={class:"sect-war-page"},z={key:0,class:"stats-grid"},P={class:"stat-item"},J={class:"stat-value win"},N={class:"stat-item"},T={class:"stat-value lose"},I={class:"stat-item"},F={class:"stat-value points"},L={class:"stat-item"},G={class:"stat-value rank"},U={key:1,class:"no-data"},q={class:"reward-alert"},A={class:"war-header"},B={class:"war-versus"},V={class:"war-side challenger"},W={class:"sect-name"},D={class:"sect-score"},E={class:"war-side defender"},H={class:"sect-name"},K={class:"sect-score"},M={key:0,class:"participants-section"},Q={class:"participants-grid"},R={class:"team-col"},X={class:"p-name"},Y={class:"p-power"},Z={key:0,class:"no-participant"},ee={class:"team-col"},ae={class:"p-name"},se={class:"p-power"},le={key:0,class:"no-participant"},te={key:0,class:"war-actions"},ne={key:1,class:"battle-replay"},re={class:"round-header"},ie={class:"round-battle"},de={class:"fighter-name"},ce={class:"fighter-power"},oe={class:"fighter-result"},ue={class:"power-bar"},ve={class:"fighter-result"},pe={class:"fighter-power"},he={class:"fighter-name"},we={class:"pending-info"},fe={class:"pending-name"},ge={class:"pending-members"},me={class:"pending-actions"},ye={key:0,class:"no-data"},_e={class:"history-left"},ke={class:"history-names"},be={class:"history-time"},je={class:"history-right"},Se={class:"history-score"},Ce={key:0,class:"no-data"},$e={class:"rank-pos"},Oe={key:0},xe={key:1},ze={key:2},Pe={key:3},Je={class:"rank-info"},Ne={class:"rank-name"},Te={class:"rank-detail"},Ie={class:"rank-points"},Fe={key:0,class:"no-data"},Le={class:"reward-info"},Ge={class:"reward-detail"},Ue={class:"sect-list"},qe=["onClick"],Ae={class:"sect-opt-name"},Be={class:"sect-opt-info"},Ve={key:0,class:"no-data"},We="/api",De=e({__name:"SectWar",setup(e){const{message:De}=t(["message"]),Ee=a(),He=s(),Ke=f("main"),Me=f(null),Qe=f([]),Re=f(null),Xe=f([]),Ye=f([]),Ze=f([]),ea=f([]),aa=f([]),sa=f(null),la=f(null),ta=f(!1),na=f(""),ra=f(!1),ia=f(!1),da=f(!1),ca=f(!1),oa=f(!1),ua=()=>({"Content-Type":"application/json",Authorization:`Bearer ${He.token}`}),va=O(()=>Qe.value.filter(e=>{var a;return e.sect_id===(null==(a=Me.value)?void 0:a.challenger_sect_id)})),pa=O(()=>Qe.value.filter(e=>{var a;return e.sect_id===(null==(a=Me.value)?void 0:a.defender_sect_id)})),ha=O(()=>ea.value.filter(e=>!e.claimed)),wa=O(()=>{let e=aa.value.filter(e=>e.id!==Re.value);return na.value&&(e=e.filter(e=>e.name.includes(na.value))),e}),fa=O(()=>{var e;if(!(null==(e=Me.value)?void 0:e.rounds_data))return[];const a=Me.value.rounds_data;return"string"==typeof a?JSON.parse(a):a}),ga=O(()=>{var e;return(null==(e=Me.value)?void 0:e.winner_sect_id)===Re.value}),ma=O(()=>!!(He.wallet&&Me.value&&Qe.value.length>=0)),ya=O(()=>{if(!Me.value||Me.value.rounds_data)return!1;return!Qe.value.find(e=>{var a;return e.wallet===(null==(a=He.wallet)?void 0:a.toLowerCase())})});function _a(e,a){const s=e.challenger.combat_power||1,l=e.defender.combat_power||1,t=s+l;return"challenger"===a?(s/t*100).toFixed(1):(l/t*100).toFixed(1)}async function ka(){try{const[e,a,s,l,t,n]=await Promise.all([fetch(`${We}/sect-war/current`,{headers:ua()}),fetch(`${We}/sect-war/pending`,{headers:ua()}),fetch(`${We}/sect-war/history`,{headers:ua()}),fetch(`${We}/sect-war/ranking`,{headers:ua()}),fetch(`${We}/sect-war/rewards`,{headers:ua()}),fetch(`${We}/sect/list`,{headers:ua()})]),r=await e.json();Me.value=r.war,Qe.value=r.participants||[],Re.value=r.mySectId;const i=await a.json();Xe.value=i.wars||[];const d=await s.json();Ye.value=d.wars||[],d.mySectId&&(Re.value=d.mySectId);const c=await l.json();if(Ze.value=c.rankings||[],Re.value){const e=Ze.value.findIndex(e=>e.sect_id===Re.value);e>=0&&(sa.value=Ze.value[e],la.value=e+1)}const o=await t.json();ea.value=o.rewards||[];const u=await n.json();aa.value=u.sects||[]}catch(e){console.error(e)}}async function ba(){if(Me.value){ra.value=!0;try{const e=await fetch(`${We}/sect-war/join`,{method:"POST",headers:ua(),body:JSON.stringify({war_id:Me.value.id})}),a=await e.json();a.ok?(De.success("æŠ¥åæˆåŠŸï¼"),ka()):De.error(a.error)}catch(e){De.error("ç½‘ç»œé”™è¯¯")}ra.value=!1}}async function ja(){if(Ee.stopAutoCultivation(),Me.value){ia.value=!0;try{const e=await fetch(`${We}/sect-war/start`,{method:"POST",headers:ua(),body:JSON.stringify({war_id:Me.value.id})}),a=await e.json();a.ok?(De.success("æˆ˜æ–—å®Œæˆï¼"),ka()):De.error(a.error)}catch(e){De.error("ç½‘ç»œé”™è¯¯")}ia.value=!1}}async function Sa(){oa.value=!0;try{const e=await fetch(`${We}/sect-war/rewards/claim`,{method:"POST",headers:ua()}),a=await e.json();a.ok?(De.success(a.message),ka()):De.error(a.error)}catch(e){De.error("ç½‘ç»œé”™è¯¯")}oa.value=!1}return v(()=>{He.token&&ka()}),(e,a)=>{const s=d,t=c,v=o,f=i,O=n,Ee=u,He=r;return g(),p("div",x,[h(l,null,{default:w(()=>[...a[4]||(a[4]=[m("p",null,[y("âš”ï¸ "),m("strong",null,"ç„°ç›Ÿé—´PVPå¯¹æˆ˜"),y("ï¼Œç›Ÿä¸»å‘èµ·æŒ‘æˆ˜")],-1),m("p",null,"ğŸ‘¥ åŒæ–¹æˆå‘˜æŠ¥åå‚æˆ˜ï¼ŒæŒ‰æˆ˜åŠ›åŒ¹é…é€è½®å¯¹å†³",-1),m("p",null,[y("ğŸ† èƒœæ–¹è·å¾—"),m("strong",null,"ç§¯åˆ†+ç„°æ™¶+è´¡çŒ®åº¦")],-1),m("p",null,"ğŸ“Š æŒ‰ç§¯åˆ†æ’åï¼Œäº‰å¤ºç„°ç›Ÿè£è€€ï¼",-1)])]),_:1}),h(O,{value:Ke.value,"onUpdate:value":a[1]||(a[1]=e=>Ke.value=e),type:"segment",animated:""},{default:w(()=>[h(f,{name:"main",tab:"âš”ï¸ ç„°ç›Ÿæˆ˜"},{default:w(()=>[h(s,{class:"war-stats-card",bordered:!1},{default:w(()=>[a[9]||(a[9]=m("div",{class:"stats-header"},[m("span",{class:"gold-title"},"âš”ï¸ ç„°ç›Ÿæˆ˜ç»©")],-1)),sa.value?(g(),p("div",z,[m("div",P,[m("div",J,_(sa.value.wins),1),a[5]||(a[5]=m("div",{class:"stat-label"},"èƒœåœº",-1))]),m("div",N,[m("div",T,_(sa.value.losses),1),a[6]||(a[6]=m("div",{class:"stat-label"},"è´Ÿåœº",-1))]),m("div",I,[m("div",F,_(sa.value.points),1),a[7]||(a[7]=m("div",{class:"stat-label"},"ç§¯åˆ†",-1))]),m("div",L,[m("div",G,_(la.value||"-"),1),a[8]||(a[8]=m("div",{class:"stat-label"},"æ’å",-1))])])):(g(),p("div",U,"æš‚æ— æˆ˜ç»©"))]),_:1}),ha.value.length?(g(),k(s,{key:0,class:"reward-alert-card",bordered:!1},{default:w(()=>[m("div",q,[m("span",null,"ğŸ ä½ æœ‰ "+_(ha.value.length)+" ä¸ªæœªé¢†å–çš„ç„°ç›Ÿæˆ˜å¥–åŠ±ï¼",1),h(t,{type:"warning",size:"small",onClick:Sa,loading:oa.value},{default:w(()=>[...a[10]||(a[10]=[y("é¢†å–å…¨éƒ¨",-1)])]),_:1},8,["loading"])])]),_:1})):b("",!0),Me.value?(g(),k(s,{key:1,class:"current-war-card",bordered:!1},{default:w(()=>[m("div",A,[a[11]||(a[11]=m("span",{class:"gold-title"},"ğŸ”¥ å½“å‰ç„°ç›Ÿæˆ˜",-1)),h(v,{type:"in_progress"===Me.value.status?"warning":"info",size:"small"},{default:w(()=>[y(_("pending"===Me.value.status?"ç­‰å¾…æ¥å—":Me.value.rounds_data?"å·²ç»“æŸ":"æŠ¥åä¸­"),1)]),_:1},8,["type"])]),m("div",B,[m("div",V,[m("div",W,_(Me.value.challenger_name),1),m("div",D,_(Me.value.challenger_score),1)]),a[12]||(a[12]=m("div",{class:"vs-badge"},"VS",-1)),m("div",E,[m("div",H,_(Me.value.defender_name),1),m("div",K,_(Me.value.defender_score),1)])]),"in_progress"===Me.value.status?(g(),p("div",M,[m("div",Q,[m("div",R,[a[13]||(a[13]=m("div",{class:"team-title"},"æŒ‘æˆ˜æ–¹",-1)),(g(!0),p(j,null,S(va.value,e=>(g(),p("div",{key:e.id,class:"participant-item"},[m("span",X,_(e.player_name),1),m("span",Y,"âš¡"+_(e.combat_power),1)]))),128)),va.value.length?b("",!0):(g(),p("div",Z,"æš‚æ— æŠ¥å"))]),m("div",ee,[a[14]||(a[14]=m("div",{class:"team-title"},"é˜²å®ˆæ–¹",-1)),(g(!0),p(j,null,S(pa.value,e=>(g(),p("div",{key:e.id,class:"participant-item"},[m("span",ae,_(e.player_name),1),m("span",se,"âš¡"+_(e.combat_power),1)]))),128)),pa.value.length?b("",!0):(g(),p("div",le,"æš‚æ— æŠ¥å"))])]),Me.value.rounds_data?b("",!0):(g(),p("div",te,[ya.value?(g(),k(t,{key:0,type:"info",onClick:ba,loading:ra.value},{default:w(()=>[...a[15]||(a[15]=[y("ğŸ“‹ æŠ¥åå‚æˆ˜",-1)])]),_:1},8,["loading"])):b("",!0),ma.value?(g(),k(t,{key:1,type:"warning",onClick:ja,loading:ia.value,disabled:!va.value.length||!pa.value.length},{default:w(()=>[...a[16]||(a[16]=[y(" âš”ï¸ å¼€å§‹æˆ˜æ–— ",-1)])]),_:1},8,["loading","disabled"])):b("",!0)]))])):b("",!0),Me.value.rounds_data?(g(),p("div",ne,[a[17]||(a[17]=m("div",{class:"replay-title"},"âš”ï¸ æˆ˜æ–—å›æ”¾",-1)),(g(!0),p(j,null,S(fa.value,e=>(g(),p("div",{key:e.round,class:"round-item"},[m("div",re,"ç¬¬ "+_(e.round)+" è½®",1),m("div",ie,[m("div",{class:C(["fighter left",{winner:e.challenger.win}])},[m("span",de,_(e.challenger.name),1),m("span",ce,"âš¡"+_(e.challenger.combat_power),1),m("span",oe,_(e.challenger.win?"âœ…":"âŒ"),1)],2),m("div",ue,[m("div",{class:"power-fill left",style:$({width:_a(e,"challenger")+"%"})},null,4),m("div",{class:"power-fill right",style:$({width:_a(e,"defender")+"%"})},null,4)]),m("div",{class:C(["fighter right",{winner:e.defender.win}])},[m("span",ve,_(e.defender.win?"âœ…":"âŒ"),1),m("span",pe,"âš¡"+_(e.defender.combat_power),1),m("span",he,_(e.defender.name),1)],2)])]))),128)),m("div",{class:C(["final-result",{win:ga.value,lose:!ga.value&&Me.value.winner_sect_id}])},_(ga.value?"ğŸ‰ èƒœåˆ©ï¼":Me.value.winner_sect_id?"ğŸ˜” å¤±è´¥...":"âš–ï¸ å¹³å±€"),3)])):b("",!0)]),_:1})):b("",!0),h(s,{class:"challenge-card",bordered:!1},{default:w(()=>[a[19]||(a[19]=m("div",{class:"war-header"},[m("span",{class:"gold-title"},"ğŸ“œ å‘èµ·æŒ‘æˆ˜")],-1)),h(t,{type:"warning",block:"",onClick:a[0]||(a[0]=e=>ta.value=!0),disabled:!!Me.value},{default:w(()=>[...a[18]||(a[18]=[y(" âš”ï¸ é€‰æ‹©ç„°ç›Ÿå‘èµ·æŒ‘æˆ˜ ",-1)])]),_:1},8,["disabled"])]),_:1}),Xe.value.length?(g(),k(s,{key:2,class:"pending-card",bordered:!1},{default:w(()=>[a[22]||(a[22]=m("div",{class:"war-header"},[m("span",{class:"gold-title"},"ğŸ“¨ æ”¶åˆ°çš„æŒ‘æˆ˜")],-1)),(g(!0),p(j,null,S(Xe.value,e=>(g(),p("div",{key:e.id,class:"pending-item"},[m("div",we,[m("span",fe,_(e.challenger_name),1),m("span",ge,_(e.challenger_members)+"äºº",1)]),m("div",me,[h(t,{type:"success",size:"small",onClick:a=>async function(e){da.value=!0;try{const a=await fetch(`${We}/sect-war/accept`,{method:"POST",headers:ua(),body:JSON.stringify({war_id:e})}),s=await a.json();s.ok?(De.success("å·²æ¥å—æŒ‘æˆ˜ï¼"),ka()):De.error(s.error)}catch(a){De.error("ç½‘ç»œé”™è¯¯")}da.value=!1}(e.id),loading:da.value},{default:w(()=>[...a[20]||(a[20]=[y("æ¥å—",-1)])]),_:1},8,["onClick","loading"]),h(t,{type:"error",size:"small",onClick:a=>async function(e){ca.value=!0;try{const a=await fetch(`${We}/sect-war/decline`,{method:"POST",headers:ua(),body:JSON.stringify({war_id:e})}),s=await a.json();s.ok?(De.success("å·²æ‹’ç»æŒ‘æˆ˜"),ka()):De.error(s.error)}catch(a){De.error("ç½‘ç»œé”™è¯¯")}ca.value=!1}(e.id),loading:ca.value},{default:w(()=>[...a[21]||(a[21]=[y("æ‹’ç»",-1)])]),_:1},8,["onClick","loading"])])]))),128))]),_:1})):b("",!0)]),_:1}),h(f,{name:"history",tab:"ğŸ“œ å†å²"},{default:w(()=>[Ye.value.length?b("",!0):(g(),p("div",ye,"æš‚æ— ç„°ç›Ÿæˆ˜è®°å½•")),(g(!0),p(j,null,S(Ye.value,e=>{return g(),p("div",{key:e.id,class:"history-item"},[m("div",_e,[m("div",ke,_(e.challenger_name)+" vs "+_(e.defender_name),1),m("div",be,_((a=e.finished_at,a?new Date(a).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"")),1)]),m("div",je,[m("div",Se,_(e.challenger_score)+" : "+_(e.defender_score),1),h(v,{type:e.winner_sect_id===Re.value?"success":e.winner_sect_id?"error":"default",size:"small"},{default:w(()=>[y(_(e.winner_sect_id===Re.value?"èƒœ":e.winner_sect_id?"è´Ÿ":"å¹³"),1)]),_:2},1032,["type"])])]);var a}),128))]),_:1}),h(f,{name:"ranking",tab:"ğŸ† ç„°æ¦œ"},{default:w(()=>[Ze.value.length?b("",!0):(g(),p("div",Ce,"æš‚æ— æ’è¡Œæ•°æ®")),(g(!0),p(j,null,S(Ze.value,(e,a)=>(g(),p("div",{key:e.id,class:C(["rank-item",{"rank-gold":0===a,"rank-silver":1===a,"rank-bronze":2===a}])},[m("div",$e,[0===a?(g(),p("span",Oe,"ğŸ¥‡")):1===a?(g(),p("span",xe,"ğŸ¥ˆ")):2===a?(g(),p("span",ze,"ğŸ¥‰")):(g(),p("span",Pe,_(a+1),1))]),m("div",Je,[m("div",Ne,_(e.sect_name),1),m("div",Te,"Lv."+_(e.sect_level)+" | "+_(e.wins)+"èƒœ "+_(e.losses)+"è´Ÿ",1)]),m("div",Ie,_(e.points)+"åˆ†",1)],2))),128))]),_:1}),h(f,{name:"rewards",tab:"ğŸ å¥–åŠ±"},{default:w(()=>[ea.value.length?b("",!0):(g(),p("div",Fe,"æš‚æ— å¥–åŠ±è®°å½•")),(g(!0),p(j,null,S(ea.value,e=>(g(),p("div",{key:e.id,class:"reward-item"},[m("div",Le,[m("div",null,_(e.challenger_name)+" vs "+_(e.defender_name),1),m("div",Ge,"ğŸ’"+_(e.reward_stones)+"ç„°æ™¶ + ğŸ…"+_(e.reward_contribution)+"è´¡çŒ®",1)]),h(v,{type:e.claimed?"default":"warning",size:"small"},{default:w(()=>[y(_(e.claimed?"å·²é¢†å–":"æœªé¢†å–"),1)]),_:2},1032,["type"])]))),128)),ha.value.length?(g(),k(t,{key:1,type:"warning",block:"",style:{"margin-top":"12px"},onClick:Sa,loading:oa.value},{default:w(()=>[...a[23]||(a[23]=[y(" é¢†å–å…¨éƒ¨å¥–åŠ± ",-1)])]),_:1},8,["loading"])):b("",!0)]),_:1})]),_:1},8,["value"]),h(He,{show:ta.value,"onUpdate:show":a[3]||(a[3]=e=>ta.value=e),preset:"card",title:"é€‰æ‹©æŒ‘æˆ˜ç›®æ ‡",style:{"max-width":"500px"}},{default:w(()=>[h(Ee,{value:na.value,"onUpdate:value":a[2]||(a[2]=e=>na.value=e),placeholder:"æœç´¢ç„°ç›Ÿåç§°...",clearable:"",style:{"margin-bottom":"12px"}},null,8,["value"]),m("div",Ue,[(g(!0),p(j,null,S(wa.value,e=>(g(),p("div",{key:e.id,class:"sect-option",onClick:a=>async function(e){try{const a=await fetch(`${We}/sect-war/challenge`,{method:"POST",headers:ua(),body:JSON.stringify({defender_sect_id:e})}),s=await a.json();s.ok?(De.success("æŒ‘æˆ˜å·²å‘å‡ºï¼"),ta.value=!1,ka()):De.error(s.error||"å‘èµ·å¤±è´¥")}catch(a){De.error("ç½‘ç»œé”™è¯¯")}}(e.id)},[m("div",Ae,_(e.name),1),m("div",Be,"Lv."+_(e.level)+" | "+_(e.member_count)+"äºº",1)],8,qe))),128)),wa.value.length?b("",!0):(g(),p("div",Ve,"æ²¡æœ‰å¯æŒ‘æˆ˜çš„ç„°ç›Ÿ"))])]),_:1},8,["show"])])}}},[["__scopeId","data-v-24e3931a"]]);export{De as default};
