import{_ as e,a,u as s}from"./index-C_Usn6qf.js";import{s as l}from"./sfx-Bhf_myqE.js";import{G as t}from"./GameGuide-Dc_uhL03.js";import{u as i}from"./naive-ui-CtewNtT3.js";import{o as r,bg as n,bF as c,bE as o,bh as u,bi as d,b7 as v,F as y,bk as p,bj as m,r as k,bf as f,k as h,aW as g,W as b}from"./vendor-CBGg7cPT.js";const w={class:"daily-dungeon"},_={key:0,class:"battle-overlay"},x={class:"battle-box"},j={class:"battle-header"},S={class:"enemy-name"},C={class:"enemy-level"},H={class:"hp-bar-wrap"},T={class:"hp-text"},E={key:0},G={key:0,class:"crit-tag"},L={key:1},A={key:0,class:"crit-tag"},B={key:0,class:"battle-result"},D={key:0,class:"result-victory"},F={class:"reward-list"},M={key:0,class:"reward-item"},O={key:1,class:"reward-item"},P={key:3,class:"reward-item"},W={key:4,class:"reward-item"},z={key:1,class:"result-defeat"},I={class:"dungeon-grid"},J=["onClick"],N={class:"card-name"},$={class:"card-desc"},q={class:"card-info"},K={class:"card-reward"},Q={key:0},R={key:1},U={key:0,class:"lock-mask"},V={key:1,class:"lock-mask exhausted-mask"},X={class:"history-section"},Y={key:0,class:"empty-hint"},Z={class:"h-name"},ee={key:0,class:"h-rewards"},ae="/api/dungeon-daily",se=e({__name:"DailyDungeon",setup(e){const se=a(),le=s(),te=i(),ie=()=>({Authorization:`Bearer ${se.token}`,"Content-Type":"application/json"}),re=k([]),ne=k([]),ce=k(!1),oe=k(!1),ue=k(""),de=k({}),ve=k({}),ye=k([]),pe=k(0),me=k(100),ke=k(null),fe=k(!1),he={easy:"ç®€å•",normal:"æ™®é€š",hard:"å›°éš¾",hell:"åœ°ç‹±"};async function ge(){try{const e=await fetch(ae+"/list",{headers:ie()}),a=await e.json();a.dungeons&&(re.value=a.dungeons)}catch{}}async function be(){try{const e=await fetch(ae+"/history",{headers:ie()}),a=await e.json();a.history&&(ne.value=a.history)}catch{}}function we(){ce.value=!1}function _e(e){return new Promise(a=>setTimeout(a,e))}return r(()=>{ge(),be()}),(e,a)=>(f(),n("div",w,[c(t,null,{default:o(()=>[...a[0]||(a[0]=[u("p",null,"ğŸ“… æ¯æ—¥é™æ¬¡æŒ‘æˆ˜å‰¯æœ¬ï¼Œæ¯æ—¥é‡ç½®",-1),u("p",null,[h("âš”ï¸ 4ä¸ªéš¾åº¦ï¼šç®€å•â†’æ™®é€šâ†’å›°éš¾â†’"),u("strong",null,"åœ°ç‹±"),h("ï¼Œéš¾åº¦è¶Šé«˜å¥–åŠ±è¶Šå¥½")],-1),u("p",null,"ğŸ å¥–åŠ±ï¼šç„°æ™¶ã€ç„°åŠ›ã€ç„°å…½ç²¾åã€ç¬¦æ–‡çŸ³ç­‰",-1),u("p",null,"ğŸ’¡ æ¯å¤©è®°å¾—æ‰“æ»¡æ¬¡æ•°ï¼Œä¸è¦æµªè´¹ï¼",-1)])]),_:1}),a[6]||(a[6]=u("div",{class:"page-title"},"æ¯æ—¥ç„°å¢ƒ",-1)),ce.value?(f(),n("div",_,[u("div",x,[u("div",j,[u("span",S,d(ve.value.name),1),u("span",C,"Lv."+d(ve.value.level),1)]),u("div",H,[u("div",{class:"hp-bar",style:v({width:me.value+"%"})},null,4),u("span",T,d(pe.value)+" / "+d(ve.value.hp),1)]),u("div",{class:"battle-log",ref_key:"logBox",ref:ke},[(f(!0),n(y,null,p(ye.value,(e,s)=>(f(),n("div",{key:s,class:g(["log-line","player"===e.actor?"log-player":"log-enemy"])},["player"===e.actor?(f(),n("span",E,[h(" âš”ï¸ ç¬¬"+d(e.round)+"å›åˆ â€” ä½ å‘èµ·æ”»å‡»ï¼Œé€ æˆ ",1),u("b",{class:g({crit:e.crit})},d(e.damage),3),a[1]||(a[1]=h(" ç‚¹ä¼¤å®³ ",-1)),e.crit?(f(),n("span",G,"æš´å‡»!")):m("",!0)])):(f(),n("span",L,[h(" ğŸ›¡ï¸ ç¬¬"+d(e.round)+"å›åˆ â€” "+d(ve.value.name)+"æ”»å‡»ä½ ï¼Œé€ æˆ ",1),u("b",{class:g({crit:e.crit})},d(e.damage),3),a[2]||(a[2]=h(" ç‚¹ä¼¤å®³ ",-1)),e.crit?(f(),n("span",A,"æš´å‡»!")):m("",!0)]))],2))),128))],512),oe.value?(f(),n("div",B,["victory"===ue.value?(f(),n("div",D,[a[3]||(a[3]=u("div",{class:"result-title"},"ğŸ‰ å¤§è·å…¨èƒœ!",-1)),u("div",F,[de.value.spiritStones?(f(),n("div",M,"ğŸ’ ç„°æ™¶ +"+d(de.value.spiritStones),1)):m("",!0),de.value.cultivation?(f(),n("div",O,"ğŸ“– ç„°åŠ› +"+d(de.value.cultivation),1)):m("",!0),de.value.items?(f(!0),n(y,{key:2},p(de.value.items,e=>(f(),n("div",{key:e,class:"reward-item"},"ğŸ "+d(e),1))),128)):m("",!0),de.value.petEssence?(f(),n("div",P,"ğŸ¾ ç„°å…½ç²¾å +"+d(de.value.petEssence),1)):m("",!0),de.value.refinementStones?(f(),n("div",W,"ğŸ’  ç¬¦æ–‡çŸ³ +"+d(de.value.refinementStones),1)):m("",!0)])])):(f(),n("div",z,[...a[4]||(a[4]=[u("div",{class:"result-title"},"ğŸ’€ æŒ‘æˆ˜å¤±è´¥",-1),u("div",{class:"result-sub"},"å®åŠ›ä¸è¶³ï¼Œä¸‹æ¬¡å†æ¥ï¼",-1)])])),u("button",{class:"btn-back",onClick:we},"è¿” å›")])):m("",!0)])])):m("",!0),u("div",I,[(f(!0),n(y,null,p(re.value,e=>(f(),n("div",{key:e.id,class:g(["dungeon-card",e.difficulty,{locked:e.locked,exhausted:!e.locked&&e.remaining<=0}]),onClick:a=>async function(e){if(le.stopAutoCultivation(),!(e.locked||e.remaining<=0||fe.value)){l.click(),fe.value=!0;try{const a=await fetch(ae+"/enter",{method:"POST",headers:ie(),body:JSON.stringify({dungeon_id:e.id})}),s=await a.json();if(!a.ok)return l.error(),void te.error(s.error||"è¿›å…¥å¤±è´¥");ce.value=!0,oe.value=!1,ue.value=s.result,de.value=s.rewards||{},ve.value=s.enemy,ye.value=[],pe.value=s.enemy.hp,me.value=100;const t=s.combatLog||[];for(let e=0;e<t.length;e++)await _e(600),ye.value.push(t[e]),void 0!==t[e].enemyHp&&(pe.value=t[e].enemyHp,me.value=Math.max(0,t[e].enemyHp/t[e].enemyMaxHp*100)),"player"===t[e].actor&&t[e].crit?l.crit():l.hit(),await b(),ke.value&&(ke.value.scrollTop=ke.value.scrollHeight);await _e(500),oe.value=!0,"victory"===s.result?l.victory():l.defeat(),ge(),be()}catch(a){l.error(),te.error("ç½‘ç»œé”™è¯¯")}finally{fe.value=!1}}}(e)},[u("div",{class:g(["card-diff",e.difficulty])},d(he[e.difficulty]),3),u("div",N,d(e.name),1),u("div",$,d(e.description),1),u("div",q,[u("span",null,"ç­‰çº§è¦æ±‚: Lv."+d(e.min_level),1),u("span",null,"æ¬¡æ•°: "+d(e.remaining)+"/"+d(e.max_entries),1)]),u("div",K,[e.rewards_config.spiritStones?(f(),n("span",Q,"ğŸ’"+d(e.rewards_config.spiritStones),1)):m("",!0),e.rewards_config.cultivation?(f(),n("span",R,"ğŸ“–"+d(e.rewards_config.cultivation),1)):m("",!0)]),e.locked?(f(),n("div",U,"ğŸ”’ ç­‰çº§ä¸è¶³")):e.remaining<=0?(f(),n("div",V,"å·²è€—å°½")):m("",!0)],10,J))),128))]),u("div",X,[a[5]||(a[5]=u("div",{class:"section-title"},"ä»Šæ—¥æŒ‘æˆ˜è®°å½•",-1)),ne.value.length?m("",!0):(f(),n("div",Y,"æš‚æ— è®°å½•")),(f(!0),n(y,null,p(ne.value,e=>(f(),n("div",{key:e.id,class:g(["history-item",e.result])},[u("span",Z,d(e.dungeon_name),1),u("span",{class:g(["h-result",e.result])},d("victory"===e.result?"âœ… èƒœåˆ©":"âŒ å¤±è´¥"),3),"victory"===e.result&&e.rewards_earned?(f(),n("span",ee," ğŸ’"+d(e.rewards_earned.spiritStones||0),1)):m("",!0)],2))),128))])]))}},[["__scopeId","data-v-8b26e91b"]]);export{se as default};
